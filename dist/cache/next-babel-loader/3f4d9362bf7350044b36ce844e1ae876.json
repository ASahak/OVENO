{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from 'react';\nimport Head from 'next/head';\nimport { useRouter } from 'next/router';\nimport { Container, Row, Col } from 'reactstrap';\nimport axios from \"lib/axiosEnv\";\nimport Router from \"next/router\";\nimport { connect } from \"react-redux\";\nimport { toast } from \"react-toastify\";\nimport styles from \"components/Home/HotSellers/elements/badge.scss\";\nimport UI_ELEMENTS from \"../../components/shared/UI\";\n\nvar _require = require('utils/auth'),\n    getToken = _require.getToken;\n\nimport Magnifier from \"react-magnifier\";\nimport { __SET_LOGGED } from \"store/saga\";\n\nvar ProductPage = function ProductPage(props) {\n  var _useRouter = useRouter(),\n      query = _useRouter.query;\n\n  var _useState = useState({}),\n      dataProd = _useState[0],\n      setDataProd = _useState[1];\n\n  var _useState2 = useState(0),\n      star = _useState2[0],\n      setStar = _useState2[1];\n\n  var _useState3 = useState(false),\n      loadingCategory = _useState3[0],\n      setLoadingCategory = _useState3[1];\n\n  var _useState4 = useState(true),\n      addToCart = _useState4[0],\n      setAddToCart = _useState4[1];\n\n  useEffect(function () {\n    try {\n      _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var _ref2, data;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!Router.query.id) {\n                  _context.next = 9;\n                  break;\n                }\n\n                _context.next = 3;\n                return axios.get('/api/product/' + Router.query.id);\n\n              case 3:\n                _ref2 = _context.sent;\n                data = _ref2.data;\n\n                if (!data.error) {\n                  _context.next = 7;\n                  break;\n                }\n\n                throw Error(data.error.message);\n\n              case 7:\n                setDataProd(data.product);\n\n                if (data.product.rating.length) {\n                  setStar(Math.round(data.product.rating.reduce(function (acc, item) {\n                    acc += item.value;\n                    return acc;\n                  }, 0) / data.product.rating.length));\n                }\n\n              case 9:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }))();\n    } catch (err) {\n      toast.error(err.response ? err.response.data : err.message, {\n        position: \"top-right\",\n        autoClose: 3000,\n        pauseOnHover: false\n      });\n    }\n  }, [query]);\n  useEffect(function () {\n    // Check if you have an product like active product\n    if (props.isUser && dataProd && props.isUser.cart.some(function (el) {\n      return el._id === dataProd._id;\n    })) {\n      setAddToCart(false);\n    }\n  }, [props.isUser, dataProd]);\n\n  var appreciate =\n  /*#__PURE__*/\n  function () {\n    var _ref3 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2(val) {\n      var _ref4, data;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n\n              if (props.isUser) {\n                _context2.next = 3;\n                break;\n              }\n\n              throw Error('Please login before appreciation!');\n\n            case 3:\n              if (!dataProd.rating.some(function (el) {\n                return el.id === props.isUser._id;\n              })) {\n                _context2.next = 5;\n                break;\n              }\n\n              throw Error(\"You can't appreciate second time\");\n\n            case 5:\n              _context2.next = 7;\n              return axios.post('/api/product/appreciate', {\n                userId: props.isUser._id,\n                id: dataProd._id,\n                value: val\n              }, {\n                headers: {\n                  Authorization: getToken('token')\n                }\n              });\n\n            case 7:\n              _ref4 = _context2.sent;\n              data = _ref4.data;\n\n              if (!data.error) {\n                _context2.next = 11;\n                break;\n              }\n\n              throw Error(data.error.message);\n\n            case 11:\n              dataProd.rating = [].concat(_toConsumableArray(dataProd.rating), [{\n                id: data.appreciate.id,\n                value: data.appreciate.value\n              }]);\n              setDataProd(dataProd); // Set new rated Product\n\n              setStar(Math.round(dataProd.rating.reduce(function (acc, item) {\n                acc += item.value;\n                return acc;\n              }, 0) / dataProd.rating.length));\n              toast.dark('The product is rated!', {\n                position: \"top-right\",\n                autoClose: 3000,\n                pauseOnHover: false\n              });\n              _context2.next = 20;\n              break;\n\n            case 17:\n              _context2.prev = 17;\n              _context2.t0 = _context2[\"catch\"](0);\n              toast.error(_context2.t0.response ? _context2.t0.response.data : _context2.t0.message, {\n                position: \"top-right\",\n                autoClose: 3000,\n                pauseOnHover: false\n              });\n\n            case 20:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 17]]);\n    }));\n\n    return function appreciate(_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var addToCartProd =\n  /*#__PURE__*/\n  function () {\n    var _ref5 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee3() {\n      var _ref6, data;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              setLoadingCategory(true);\n\n              if (props.isUser) {\n                _context3.next = 4;\n                break;\n              }\n\n              throw Error('Please login before add product!');\n\n            case 4:\n              if (!(props.isUser && dataProd && props.isUser.cart.some(function (el) {\n                return el._id === dataProd._id;\n              }))) {\n                _context3.next = 6;\n                break;\n              }\n\n              throw Error(\"You have this product in your cart already!\");\n\n            case 6:\n              _context3.next = 8;\n              return axios.post('/api/cart/addToCart', {\n                userId: props.isUser._id,\n                id: dataProd._id,\n                count: 1\n              }, {\n                headers: {\n                  Authorization: getToken('token')\n                }\n              });\n\n            case 8:\n              _ref6 = _context3.sent;\n              data = _ref6.data;\n\n              if (!data.error) {\n                _context3.next = 12;\n                break;\n              }\n\n              throw Error(data.error);\n\n            case 12:\n              props.isUser.cart.push({\n                _id: dataProd._id,\n                count: 1\n              });\n\n              __SET_LOGGED({\n                user: props.isUser\n              }).next();\n\n              setAddToCart(false);\n              toast.dark(data.message, {\n                position: \"top-right\",\n                autoClose: 3000,\n                pauseOnHover: false\n              });\n              _context3.next = 21;\n              break;\n\n            case 18:\n              _context3.prev = 18;\n              _context3.t0 = _context3[\"catch\"](0);\n              toast.error(_context3.t0.response ? _context3.t0.response.data : _context3.t0.message, {\n                position: \"top-right\",\n                autoClose: 3000,\n                pauseOnHover: false\n              });\n\n            case 21:\n              _context3.prev = 21;\n              setLoadingCategory(false);\n              return _context3.finish(21);\n\n            case 24:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[0, 18, 21, 24]]);\n    }));\n\n    return function addToCartProd() {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(\"div\", {\n    className: \"jsx-2824650240\"\n  }, __jsx(Head, null, __jsx(\"title\", {\n    className: \"jsx-2824650240\"\n  }, \"Product\")), __jsx(Container, null, __jsx(Row, null, __jsx(Col, {\n    sm: \"12\",\n    md: \"6\"\n  }, __jsx(\"div\", {\n    className: \"jsx-2824650240\" + \" \" + \"product-image_wrap\"\n  }, dataProd._id ? __jsx(Magnifier, {\n    src: dataProd.photo.replace(/\\\\/g, \"/\"),\n    mgWidth: 200,\n    mgHeight: 200,\n    zoomFactor: 2.5,\n    width: '100%'\n  }) : __jsx(\"div\", {\n    className: \"jsx-2824650240\" + \" \" + \"product-image_wrap_loading\"\n  }, __jsx(\"img\", {\n    src: require('../../assets/images/loading.gif'),\n    className: \"jsx-2824650240\"\n  })))), dataProd._id && __jsx(React.Fragment, null, __jsx(Col, {\n    sm: \"12\",\n    md: \"6\"\n  }, __jsx(\"div\", {\n    className: \"jsx-2824650240\" + \" \" + \"product-details-wrap\"\n  }, __jsx(\"div\", {\n    className: \"jsx-2824650240\" + \" \" + \"product-details-wrap__highway\"\n  }, __jsx(\"span\", {\n    className: \"jsx-2824650240\" + \" \" + \"highway_category \".concat(!dataProd.subCategory ? 'highway_no_subCategory' : '')\n  }, dataProd.category), dataProd.subCategory && __jsx(\"span\", {\n    className: \"jsx-2824650240\" + \" \" + \"highway_subCategory\"\n  }, dataProd.subCategory)), __jsx(\"h4\", {\n    className: \"jsx-2824650240\"\n  }, dataProd.name), __jsx(\"div\", {\n    className: \"jsx-2824650240\" + \" \" + \"product-details-wrap__price\"\n  }, dataProd.sale !== 0 ? __jsx(React.Fragment, null, __jsx(\"span\", {\n    className: \"jsx-2824650240\" + \" \" + (styles['slider_item-bottom_price_real'] || \"\")\n  }, Math.round(dataProd.price - dataProd.price * dataProd.sale / 100), \"$\"), __jsx(\"span\", {\n    className: \"jsx-2824650240\" + \" \" + (styles['slider_item-bottom_price_del'] || \"\")\n  }, dataProd.price, \"$\")) : __jsx(\"span\", {\n    className: \"jsx-2824650240\" + \" \" + (styles['slider_item-bottom_price_real'] || \"\")\n  }, dataProd.price, \"$\")), __jsx(\"div\", {\n    className: \"jsx-2824650240\" + \" \" + \"product-details-wrap_stars\"\n  }, Array(5).fill('').map(function (_, index) {\n    if (star > index) {\n      return __jsx(\"span\", {\n        key: index,\n        onClick: function onClick() {\n          return appreciate(index + 1);\n        },\n        className: \"jsx-2824650240\" + \" \" + \"lnr lnr-star\"\n      });\n    } else {\n      return __jsx(\"span\", {\n        key: index,\n        onClick: function onClick() {\n          return appreciate(index + 1);\n        },\n        className: \"jsx-2824650240\" + \" \" + \"lnr lnr-star half\"\n      });\n    }\n  })), __jsx(UI_ELEMENTS.Button, {\n    icon: loadingCategory ? {\n      dir: 'right',\n      element: 'loading'\n    } : {},\n    type: \"submit\",\n    disabled: !addToCart,\n    text: addToCart ? \"Add to cart\" : 'Already in your cart',\n    width: addToCart ? 170 : 200,\n    onClick: function onClick() {\n      return addToCartProd();\n    },\n    margin: ['20px', '0', '0', '0'],\n    attr: [{\n      id: 'addBtn'\n    }],\n    size: \"sm\"\n  }))), __jsx(Col, {\n    sm: \"12\"\n  }, __jsx(\"div\", {\n    className: \"jsx-2824650240\" + \" \" + \"product-description\"\n  }, __jsx(\"h4\", {\n    className: \"jsx-2824650240\"\n  }, \"Description\"), __jsx(\"p\", {\n    className: \"jsx-2824650240\"\n  }, dataProd.description || 'No description')))))), __jsx(_JSXStyle, {\n    id: \"2824650240\"\n  }, [\".product-image_wrap.jsx-2824650240{margin-bottom:20px;}\"]));\n};\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    isUser: state.auth.user\n  };\n};\n\nvar mapDispatchToProps = {};\nexport default connect(mapStateToProps, mapDispatchToProps)(ProductPage);","map":null,"metadata":{},"sourceType":"module"}