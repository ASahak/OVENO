{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _Reflect$construct from \"@babel/runtime-corejs2/core-js/reflect/construct\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) {\n  function isNativeReflectConstruct() {\n    if (typeof Reflect === \"undefined\" || !_Reflect$construct) return false;\n    if (_Reflect$construct.sham) return false;\n    if (typeof Proxy === \"function\") return true;\n\n    try {\n      Date.prototype.toString.call(_Reflect$construct(Date, [], function () {}));\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  return function () {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (isNativeReflectConstruct()) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = _Reflect$construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nimport React from 'react';\nimport styles from './style.scss';\nimport Badge from 'components/Home/HotSellers/elements/Badge';\nimport { Row, Col } from 'reactstrap';\nimport axios from \"lib/axiosEnv\";\nimport { toast } from \"react-toastify\";\nimport { RANGE_SLIDER } from 'utils';\n\nvar _require = require('utils/auth'),\n    getToken = _require.getToken;\n\nimport Router from 'next/router';\nimport { Bus } from \"lib/EventEmitter\";\n\nvar Products =\n/*#__PURE__*/\nfunction (_React$PureComponent) {\n  _inherits(Products, _React$PureComponent);\n\n  var _super = _createSuper(Products);\n\n  function Products(props) {\n    var _this;\n\n    _classCallCheck(this, Products);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"componentDidMount\",\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var data, dataCount;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return _this.getItems();\n\n            case 3:\n              data = _context.sent;\n\n              if (!(!data.status || data.error)) {\n                _context.next = 6;\n                break;\n              }\n\n              throw Error(data.error);\n\n            case 6:\n              _context.next = 8;\n              return axios.get('/api/products/getCount', {\n                params: _this.returnParams()\n              });\n\n            case 8:\n              dataCount = _context.sent;\n\n              if (!dataCount.data.error) {\n                _context.next = 11;\n                break;\n              }\n\n              throw Error(dataCount.data.error);\n\n            case 11:\n              _this.setState({\n                productAllCount: dataCount.data.count,\n                productsData: data.products\n              });\n\n              _context.next = 18;\n              break;\n\n            case 14:\n              _context.prev = 14;\n              _context.t0 = _context[\"catch\"](0);\n\n              _this.setState({\n                productsData: []\n              });\n\n              toast.error(_context.t0.response ? _context.t0.response.data : _context.t0.message, {\n                position: \"top-right\",\n                autoClose: 3000,\n                pauseOnHover: false\n              });\n\n            case 18:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 14]]);\n    })));\n\n    _this.state = {\n      productsData: null,\n      pageSize: 8,\n      activePage: 1,\n      productAllCount: null,\n      categorySlug: null,\n      subCategorySlug: null\n    };\n    _this.removeProduct = _this.removeProduct.bind(_assertThisInitialized(_this));\n    _this.filterByPage = _this.filterByPage.bind(_assertThisInitialized(_this));\n    _this.getItems = _this.getItems.bind(_assertThisInitialized(_this));\n    _this.returnParams = _this.returnParams.bind(_assertThisInitialized(_this));\n    Bus.subscribe('filterByCategory',\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      var data, dataCount;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return _this.getItems();\n\n            case 3:\n              data = _context2.sent;\n\n              if (!data.error) {\n                _context2.next = 6;\n                break;\n              }\n\n              throw Error(data.error);\n\n            case 6:\n              _context2.next = 8;\n              return axios.get('/api/products/getCount', {\n                params: _this.returnParams()\n              });\n\n            case 8:\n              dataCount = _context2.sent;\n\n              if (!dataCount.data.error) {\n                _context2.next = 11;\n                break;\n              }\n\n              throw Error(dataCount.data.error.message);\n\n            case 11:\n              _this.setState({\n                productAllCount: dataCount.data.count,\n                activePage: 1,\n                productsData: data.products\n              });\n\n              _context2.next = 17;\n              break;\n\n            case 14:\n              _context2.prev = 14;\n              _context2.t0 = _context2[\"catch\"](0);\n              toast.error(_context2.t0.response ? _context2.t0.response.data : _context2.t0.message, {\n                position: \"top-right\",\n                autoClose: 3000,\n                pauseOnHover: false\n              });\n\n            case 17:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 14]]);\n    })));\n    return _this;\n  }\n\n  _createClass(Products, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState, snapshot) {\n      var _this2 = this;\n\n      if (prevProps.filterByRange !== this.props.filterByRange) {\n        // Detecting changes of Range Slider\n        var _this$props$filterByR = _slicedToArray(this.props.filterByRange, 2),\n            min = _this$props$filterByR[0],\n            max = _this$props$filterByR[1];\n\n        Router.push({\n          pathname: Router.pathname,\n          query: _objectSpread({}, Router.query, {\n            page: 1,\n            minPrice: min,\n            maxPrice: max\n          })\n        }).then(\n        /*#__PURE__*/\n        _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee3() {\n          var dataCount, data;\n          return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n            while (1) {\n              switch (_context3.prev = _context3.next) {\n                case 0:\n                  _context3.next = 2;\n                  return axios.get('/api/products/getCount', {\n                    params: _this2.returnParams()\n                  });\n\n                case 2:\n                  dataCount = _context3.sent;\n\n                  if (!dataCount.data.error) {\n                    _context3.next = 5;\n                    break;\n                  }\n\n                  throw Error(dataCount.data.error);\n\n                case 5:\n                  _context3.next = 7;\n                  return _this2.getItems();\n\n                case 7:\n                  data = _context3.sent;\n\n                  _this2.setState({\n                    activePage: 1,\n                    productAllCount: dataCount.data.count,\n                    productsData: data.products\n                  });\n\n                case 9:\n                case \"end\":\n                  return _context3.stop();\n              }\n            }\n          }, _callee3);\n        })));\n      }\n\n      if (prevProps.updatedProduct !== this.props.updatedProduct) {\n        // Detecting changes of add or edit product\n        var prevDataProds = _toConsumableArray(this.state.productsData);\n\n        if (this.props.updatedProduct.type === 'edit') {\n          var updatedIndex = prevDataProds.findIndex(function (e) {\n            return e._id === _this2.props.updatedProduct._id;\n          });\n\n          if (updatedIndex > -1) {\n            prevDataProds[updatedIndex] = this.props.updatedProduct;\n            this.setState({\n              productsData: prevDataProds\n            });\n          }\n        } else if (this.props.updatedProduct.type === 'add') {\n          prevDataProds.push(this.props.updatedProduct);\n          this.setState({\n            productsData: prevDataProds\n          });\n        }\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      Bus.unsubscribe('filterByCategory');\n    }\n  }, {\n    key: \"returnParams\",\n    value: function returnParams() {\n      var params = new URLSearchParams(window.location.search);\n      var page = params.get('page') || 1;\n      var limit = this.state.pageSize;\n      var category = params.get('category');\n      var name = params.get('name');\n      var subCategory = params.get('subCategory');\n      var filterMin = params.get('minPrice') || RANGE_SLIDER[0];\n      var filterMax = params.get('maxPrice') || RANGE_SLIDER[1];\n      return {\n        name: name,\n        limit: limit,\n        page: page,\n        category: category,\n        subCategory: subCategory,\n        filterMin: filterMin,\n        filterMax: filterMax\n      };\n    }\n  }, {\n    key: \"getItems\",\n    value: function () {\n      var _getItems = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4() {\n        var params, page, _ref4, data;\n\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                params = new URLSearchParams(window.location.search);\n                page = params.get('page');\n\n                if (page) {\n                  this.setState({\n                    activePage: +page\n                  });\n                } else page = 1;\n\n                _context4.next = 5;\n                return axios.get('/api/products/get', {\n                  params: _objectSpread({}, this.returnParams(), {\n                    page: page\n                  })\n                });\n\n              case 5:\n                _ref4 = _context4.sent;\n                data = _ref4.data;\n                return _context4.abrupt(\"return\", data);\n\n              case 8:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function getItems() {\n        return _getItems.apply(this, arguments);\n      }\n\n      return getItems;\n    }()\n  }, {\n    key: \"filterByPage\",\n    value: function filterByPage(page) {\n      var _this3 = this;\n\n      Router.push({\n        pathname: Router.pathname,\n        query: _objectSpread({}, Router.query, {\n          page: page\n        })\n      }).then(\n      /*#__PURE__*/\n      _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee5() {\n        var data;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.next = 2;\n                return _this3.getItems();\n\n              case 2:\n                data = _context5.sent;\n\n                _this3.setState({\n                  activePage: +page,\n                  productsData: data.products\n                });\n\n              case 4:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      })));\n    }\n  }, {\n    key: \"removeProduct\",\n    value: function () {\n      var _removeProduct = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee6(dataId) {\n        var _ref6, data, dataProds, dataCount;\n\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.prev = 0;\n                _context6.next = 3;\n                return axios[\"delete\"]('/api/product/delete', {\n                  headers: {\n                    Authorization: getToken('token')\n                  },\n                  data: {\n                    id: dataId\n                  }\n                });\n\n              case 3:\n                _ref6 = _context6.sent;\n                data = _ref6.data;\n\n                if (!data.error) {\n                  _context6.next = 7;\n                  break;\n                }\n\n                throw Error(data.error);\n\n              case 7:\n                _context6.next = 9;\n                return this.getItems();\n\n              case 9:\n                dataProds = _context6.sent;\n\n                if (!(!dataProds.status || dataProds.error)) {\n                  _context6.next = 12;\n                  break;\n                }\n\n                throw Error(dataProds.error);\n\n              case 12:\n                _context6.next = 14;\n                return axios.get('/api/products/getCount', {\n                  params: this.returnParams()\n                });\n\n              case 14:\n                dataCount = _context6.sent;\n\n                if (!dataCount.data.error) {\n                  _context6.next = 17;\n                  break;\n                }\n\n                throw Error(dataCount.data.error);\n\n              case 17:\n                this.setState({\n                  productAllCount: dataCount.data.count,\n                  productsData: dataProds.products\n                });\n                toast.dark(data.message, {\n                  position: \"top-right\",\n                  autoClose: 3000,\n                  pauseOnHover: false\n                });\n                _context6.next = 24;\n                break;\n\n              case 21:\n                _context6.prev = 21;\n                _context6.t0 = _context6[\"catch\"](0);\n                toast.error(_context6.t0.response ? _context6.t0.response.data : _context6.t0.message, {\n                  position: \"top-right\",\n                  autoClose: 3000,\n                  pauseOnHover: false\n                });\n\n              case 24:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this, [[0, 21]]);\n      }));\n\n      function removeProduct(_x) {\n        return _removeProduct.apply(this, arguments);\n      }\n\n      return removeProduct;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      return __jsx(React.Fragment, null, __jsx(Row, {\n        className: styles['main-shop_content']\n      }, !this.state.productsData ? __jsx(\"img\", {\n        className: styles['main-shop_content_loading_gif'],\n        src: require('../../../assets/images/loading.gif'),\n        alt: \"\"\n      }) : this.state.productsData.length ? this.state.productsData.map(function (slide) {\n        return __jsx(Col, {\n          md: 4,\n          sm: 6,\n          lg: 3,\n          key: slide._id\n        }, \" \", __jsx(Badge, {\n          isAdmin: _this4.props.isAdmin,\n          isUser: _this4.props.isUser,\n          removeProduct: _this4.removeProduct,\n          editProduct: _this4.props.openEditModal,\n          mainData: slide\n        }));\n      }) : __jsx(Col, {\n        sm: 12\n      }, __jsx(\"p\", {\n        className: styles['main-shop_content_no-result']\n      }, \"No result!\"))), __jsx(\"div\", {\n        className: styles['pagination-wrap']\n      }, new Array(Math.ceil(this.state.productAllCount / this.state.pageSize)).fill('').map(function (_el, index) {\n        return __jsx(\"span\", {\n          key: index,\n          className: _this4.state.activePage === index + 1 ? 'activeBtn' : '',\n          onClick: function onClick() {\n            return _this4.filterByPage(index + 1);\n          }\n        }, index + 1);\n      })));\n    }\n  }]);\n\n  return Products;\n}(React.PureComponent);\n\nexport { Products as default };\nProducts.defaultProps = {\n  isAdmin: false,\n  isUser: false,\n  filterByRange: RANGE_SLIDER\n};","map":null,"metadata":{},"sourceType":"module"}