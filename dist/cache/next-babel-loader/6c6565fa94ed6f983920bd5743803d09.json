{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect } from 'react';\nimport axios from \"lib/axiosEnv\";\nimport { connect } from \"react-redux\";\nimport { Col, Container, Row } from \"reactstrap\";\n\nvar _require = require('utils/auth'),\n    getToken = _require.getToken;\n\nimport ImageProd from \"components/Shop/elements/imageProduct\";\nimport { toast } from \"react-toastify\";\nimport { __SET_LOGGED } from \"store/saga\";\n\nvar EveryRow = function EveryRow(props) {\n  var _useState = useState(props.data.count),\n      countProd = _useState[0],\n      setCountProd = _useState[1];\n\n  var countIncDec =\n  /*#__PURE__*/\n  function () {\n    var _ref = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee(type) {\n      var count, _ref2, data;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!(type === 'dec' && countProd === 1)) {\n                _context.next = 2;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 2:\n              count = type === 'inc' ? countProd + 1 : countProd - 1;\n              _context.prev = 3;\n              _context.next = 6;\n              return axios.put('/api/cart/updateCount', {\n                userId: props.userId,\n                id: props.data._id,\n                count: count\n              }, {\n                headers: {\n                  Authorization: getToken('token')\n                }\n              });\n\n            case 6:\n              _ref2 = _context.sent;\n              data = _ref2.data;\n\n              if (!data.error) {\n                _context.next = 10;\n                break;\n              }\n\n              throw Error(data.error);\n\n            case 10:\n              setCountProd(count);\n              props.incrementDecrement(props.data._id, count);\n              _context.next = 17;\n              break;\n\n            case 14:\n              _context.prev = 14;\n              _context.t0 = _context[\"catch\"](3);\n              toast.error(_context.t0.response ? _context.t0.response.data : _context.t0.message, {\n                position: \"top-right\",\n                autoClose: 3000,\n                pauseOnHover: false\n              });\n\n            case 17:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[3, 14]]);\n    }));\n\n    return function countIncDec(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var deleteProduct =\n  /*#__PURE__*/\n  function () {\n    var _ref3 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      var _ref4, data;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return axios[\"delete\"]('/api/cart/deleteProduct', {\n                headers: {\n                  Authorization: getToken('token')\n                },\n                data: {\n                  userId: props.userId,\n                  id: props.data._id\n                }\n              });\n\n            case 3:\n              _ref4 = _context2.sent;\n              data = _ref4.data;\n\n              if (!data.error) {\n                _context2.next = 7;\n                break;\n              }\n\n              throw Error(data.error);\n\n            case 7:\n              props.removeField(props.data._id);\n              toast.dark('Product was removed successfully!', {\n                position: \"top-right\",\n                autoClose: 3000,\n                pauseOnHover: false\n              });\n              _context2.next = 14;\n              break;\n\n            case 11:\n              _context2.prev = 11;\n              _context2.t0 = _context2[\"catch\"](0);\n              toast.error(_context2.t0.response ? _context2.t0.response.data : _context2.t0.message, {\n                position: \"top-right\",\n                autoClose: 3000,\n                pauseOnHover: false\n              });\n\n            case 14:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 11]]);\n    }));\n\n    return function deleteProduct() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(\"div\", {\n    className: \"single-row_cart \".concat(props.data.removed ? 'cart-removed-wrap' : '')\n  }, !props.data.removed ? __jsx(React.Fragment, null, __jsx(\"div\", {\n    className: \"single-row_cart__photo\"\n  }, __jsx(ImageProd, {\n    src: props.data.photo\n  })), __jsx(\"div\", {\n    className: \"single-row_cart__name\"\n  }, __jsx(\"span\", null, props.data.name)), __jsx(\"div\", {\n    className: \"single-row_cart__price\"\n  }, __jsx(\"span\", null, (props.data.sale > 0 ? Math.round(props.data.price - props.data.price * props.data.sale / 100) : props.data.price) * countProd)), __jsx(\"div\", {\n    className: \"single-row_cart__count\"\n  }, __jsx(\"div\", null, __jsx(\"span\", null, countProd), __jsx(\"p\", null, __jsx(\"span\", {\n    className: \"lnr lnr-chevron-up\",\n    onClick: function onClick() {\n      return countIncDec('inc');\n    }\n  }), __jsx(\"span\", {\n    className: \"lnr lnr-chevron-down\",\n    onClick: function onClick() {\n      return countIncDec('dec');\n    }\n  }))), __jsx(\"span\", {\n    className: \"lnr lnr-trash\",\n    onClick: function onClick() {\n      return deleteProduct();\n    }\n  }))) : __jsx(\"div\", {\n    className: \"single-row_cart__removed\"\n  }, \"This Product was removed \", __jsx(\"span\", {\n    className: \"lnr lnr-trash\",\n    onClick: function onClick() {\n      return deleteProduct();\n    }\n  })));\n};\n\nvar Cart = function Cart(props) {\n  var _useState2 = useState([]),\n      products = _useState2[0],\n      setProducts = _useState2[1];\n\n  useEffect(function () {\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee3() {\n      var _ref6, data, newProds;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!props.isUser) {\n                _context3.next = 6;\n                break;\n              }\n\n              _context3.next = 3;\n              return axios.get('/api/cart/getCart', {\n                headers: {\n                  Authorization: getToken('token')\n                },\n                params: {\n                  ids: _toConsumableArray(props.isUser.cart.map(function (id) {\n                    return id._id;\n                  }))\n                }\n              });\n\n            case 3:\n              _ref6 = _context3.sent;\n              data = _ref6.data;\n\n              if (data.error) {\n                console.error(data.error);\n              } else {\n                newProds = [];\n                props.isUser.cart.map(function (el) {\n                  var find = data.products.find(function (e) {\n                    return e._id === el._id;\n                  });\n\n                  if (find) {\n                    newProds.push(_objectSpread({}, find, {\n                      count: el.count\n                    }));\n                  } else newProds.push({\n                    _id: el._id,\n                    removed: true\n                  });\n                });\n                setProducts(newProds);\n              }\n\n            case 6:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }))();\n  }, [props.isUser]);\n\n  var _incrementDecrement = function incrementDecrement(id, count) {\n    var storeProds = _toConsumableArray(props.isUser.cart);\n\n    var storeIndex = storeProds.findIndex(function (el) {\n      return el._id === id;\n    });\n\n    if (storeIndex > -1) {\n      storeProds[storeIndex].count = count;\n    }\n\n    props.isUser.cart = storeProds;\n\n    __SET_LOGGED({\n      user: props.isUser\n    }).next();\n  };\n\n  var _removeField = function removeField(id) {\n    var prods = _toConsumableArray(products);\n\n    var matchedProd = prods.findIndex(function (el) {\n      return el._id === id;\n    });\n\n    if (matchedProd > -1) {\n      prods.splice(matchedProd, 1);\n    }\n\n    setProducts(prods); // Update Cart Modal on header\n\n    var storeProds = _toConsumableArray(props.isUser.cart);\n\n    var storeIndex = storeProds.findIndex(function (el) {\n      return el._id === id;\n    });\n\n    if (storeIndex > -1) {\n      storeProds.splice(storeIndex, 1);\n    }\n\n    props.isUser.cart = storeProds;\n\n    __SET_LOGGED({\n      user: props.isUser\n    }).next();\n  };\n\n  return __jsx(Container, null, __jsx(Row, null, __jsx(Col, {\n    sm: \"12\"\n  }, __jsx(\"div\", {\n    className: \"jsx-2636193806\" + \" \" + \"cart-main-wrap\"\n  }, __jsx(\"div\", {\n    className: \"jsx-2636193806\" + \" \" + \"cart-header\"\n  }, __jsx(\"span\", {\n    className: \"jsx-2636193806\"\n  }, \"Photo\"), __jsx(\"span\", {\n    className: \"jsx-2636193806\"\n  }, \"Name\"), __jsx(\"span\", {\n    className: \"jsx-2636193806\"\n  }, \"Price\"), __jsx(\"span\", {\n    className: \"jsx-2636193806\"\n  }, \"Count\")), __jsx(\"div\", {\n    className: \"jsx-2636193806\" + \" \" + \"cart-body\"\n  }, products.map(function (el) {\n    return __jsx(EveryRow, {\n      key: el._id,\n      userId: props.isUser ? props.isUser._id : '',\n      data: el,\n      removeField: function removeField(id) {\n        return _removeField(id);\n      },\n      incrementDecrement: function incrementDecrement(id, count) {\n        return _incrementDecrement(id, count);\n      }\n    });\n  }))))), __jsx(_JSXStyle, {\n    id: \"2636193806\"\n  }, [\".cart-main-wrap.jsx-2636193806{overflow-y:auto;}\", \".cart-header.jsx-2636193806,.cart-body.jsx-2636193806{min-width:700px;}\"]));\n};\n\nCart.getInitialProps =\n/*#__PURE__*/\nfunction () {\n  var _ref7 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee4(ctx) {\n    var req, res, token;\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            req = ctx.req, res = ctx.res;\n            token = req.headers.cookie;\n            if (!token) res.redirect('/login');\n            return _context4.abrupt(\"return\", {\n              status: true\n            });\n\n          case 4:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n\n  return function (_x2) {\n    return _ref7.apply(this, arguments);\n  };\n}();\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    isUser: state.auth.user\n  };\n};\n\nvar mapDispatchToProps = {};\nexport default connect(mapStateToProps, mapDispatchToProps)(Cart);","map":null,"metadata":{},"sourceType":"module"}