{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _Reflect$construct from \"@babel/runtime-corejs2/core-js/reflect/construct\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) {\n  function isNativeReflectConstruct() {\n    if (typeof Reflect === \"undefined\" || !_Reflect$construct) return false;\n    if (_Reflect$construct.sham) return false;\n    if (typeof Proxy === \"function\") return true;\n\n    try {\n      Date.prototype.toString.call(_Reflect$construct(Date, [], function () {}));\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  return function () {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (isNativeReflectConstruct()) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = _Reflect$construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nimport React from 'react';\nimport { Container, Row, Col } from 'reactstrap';\nimport classesMiddleWrap from './middleWrap.scss';\nimport Router from 'next/router';\nimport { ModalToggle } from \"utils/common\";\nimport { connect } from \"react-redux\";\nimport axios from \"lib/axiosEnv\";\nimport { Bus } from \"lib/EventEmitter\";\n\nvar _require = require('utils/auth'),\n    getToken = _require.getToken;\n\nvar MiddleWrap =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(MiddleWrap, _React$Component);\n\n  var _super = _createSuper(MiddleWrap);\n\n  function MiddleWrap(props) {\n    var _this;\n\n    _classCallCheck(this, MiddleWrap);\n\n    _this = _super.call(this, props);\n    _this.cartRef = React.createRef();\n    _this._modal = new ModalToggle();\n    _this.state = {\n      dataCart: []\n    };\n    _this.searchRef = React.createRef();\n    Bus.subscribe('filterByCategory', function (reset) {\n      if (reset && reset.searchReset && _this.searchRef.current) {\n        _this.searchRef.current.value = '';\n      }\n    });\n    return _this;\n  }\n\n  _createClass(MiddleWrap, [{\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      Bus.unsubscribe('filterByCategory');\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      if (Router.router.components.hasOwnProperty('/shop')) {\n        setTimeout(function () {\n          var query = _objectSpread({}, Router.query);\n\n          _this2.searchRef.current.value = query.name || '';\n        }, 0);\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState, snapshot) {\n      var _this3 = this;\n\n      if (prevProps.isUser !== this.props.isUser) {\n        _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee() {\n          var _ref2, data;\n\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _context.next = 2;\n                  return axios.get('/api/cart/getCart', {\n                    headers: {\n                      Authorization: getToken('token')\n                    },\n                    params: {\n                      ids: _toConsumableArray(_this3.props.isUser.cart.map(function (id) {\n                        return id._id;\n                      }))\n                    }\n                  });\n\n                case 2:\n                  _ref2 = _context.sent;\n                  data = _ref2.data;\n\n                  if (!data.error) {\n                    _context.next = 7;\n                    break;\n                  }\n\n                  console.error(data.error);\n                  return _context.abrupt(\"return\");\n\n                case 7:\n                  _this3.setState({\n                    dataCart: function () {\n                      var cart = [];\n\n                      _this3.props.isUser.cart.forEach(function (item) {\n                        var findMatched = data.products.find(function (el) {\n                          return el._id === item._id;\n                        });\n\n                        if (findMatched) {\n                          cart.push({\n                            id: item._id,\n                            name: findMatched.name,\n                            count: item.count,\n                            imgPath: findMatched.photo\n                          });\n                        } else {\n                          // Detect Already Removed Products\n                          cart.push({\n                            removed: true\n                          });\n                        }\n                      });\n\n                      return cart.slice(0, 2);\n                    }()\n                  });\n\n                case 8:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }))();\n      }\n    }\n  }, {\n    key: \"__showLangModal\",\n    value: function __showLangModal(ref, hint) {\n      return ref.current && this._modal.showModal(ref.current, false, hint);\n    }\n  }, {\n    key: \"__hideModal\",\n    value: function __hideModal() {\n      this._modal.customHideModal();\n    }\n  }, {\n    key: \"searchByName\",\n    value: function searchByName() {\n      if (this.searchRef.current) {\n        var query = _objectSpread({}, Router.query);\n\n        Router.push({\n          pathname: '/shop',\n          query: _objectSpread({}, query, {\n            name: this.searchRef.current.value\n          })\n        }).then(function () {\n          return Bus.dispatch('filterByCategory');\n        });\n      }\n    }\n  }, {\n    key: \"triggerSearchName\",\n    value: function triggerSearchName(evt) {\n      if (evt.key === 'Enter') {\n        this.searchByName();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      return __jsx(\"div\", {\n        className: classesMiddleWrap.middle_content_header\n      }, __jsx(Container, null, __jsx(Row, {\n        className: \"align-items-center\"\n      }, __jsx(Col, {\n        xs: \"7\",\n        sm: \"7\",\n        md: \"4\",\n        className: classesMiddleWrap.logo_content\n      }, __jsx(\"a\", {\n        href: \"/\",\n        className: \"d-inline-flex align-items-center justify-content-md-start justify-content-center\"\n      }, __jsx(\"img\", {\n        className: \"mr-2\",\n        src: require('../../../../assets/images/logo.png'),\n        alt: \"\"\n      }), \"VENO\")), __jsx(Col, {\n        xs: \"12\",\n        sm: \"12\",\n        md: \"5\",\n        className: classesMiddleWrap.search_block\n      }, __jsx(\"div\", {\n        id: classesMiddleWrap.main_search\n      }, __jsx(\"div\", {\n        className: classesMiddleWrap.search_wrap\n      }, __jsx(\"input\", {\n        type: \"text\",\n        ref: this.searchRef,\n        onKeyPress: function onKeyPress(e) {\n          return _this4.triggerSearchName(e);\n        },\n        placeholder: \"Search entire store here...\"\n      }), __jsx(\"button\", {\n        type: \"button\",\n        onClick: function onClick() {\n          return _this4.searchByName();\n        }\n      }, __jsx(\"span\", {\n        className: \"lnr lnr-magnifier\"\n      }))))), this.props.isUser ? __jsx(Col, {\n        xs: \"5\",\n        sm: \"5\",\n        md: \"3\",\n        className: classesMiddleWrap.cart_item_parent\n      }, __jsx(\"a\", {\n        className: classesMiddleWrap.cart_wrap,\n        onClick: this.__showLangModal.bind(this, this.cartRef, 'noClose')\n      }, __jsx(\"span\", {\n        className: \"\".concat(classesMiddleWrap.lnr, \" lnr lnr-cart\")\n      }), \"My cart: \", this.props.isUser.cart.length, \" item\", __jsx(\"i\", {\n        className: \"\".concat(classesMiddleWrap.fas, \" fas fa-angle-down\")\n      })), __jsx(ShopCart, {\n        hideModal: this.__hideModal.bind(this),\n        ref: this.cartRef,\n        data: this.state.dataCart\n      })) : '')));\n    }\n  }]);\n\n  return MiddleWrap;\n}(React.Component);\n\nvar ShopCart = React.forwardRef(function (_ref3, ref) {\n  var data = _ref3.data,\n      noHide = _ref3.noHide,\n      hideModal = _ref3.hideModal;\n\n  var _cart = data.map(function (item, index) {\n    return __jsx(\"li\", {\n      key: item.removed ? index : item.id,\n      className: classesMiddleWrap['main-cart-modal-item']\n    }, item.removed ? __jsx(\"span\", null, \"This Item removed\") : __jsx(React.Fragment, null, __jsx(\"span\", null, __jsx(\"img\", {\n      src: item.imgPath,\n      alt: \"no image\"\n    }), __jsx(\"b\", null, item.name)), __jsx(\"div\", null, __jsx(\"span\", null, \"x \", __jsx(\"br\", null), item.count))));\n  });\n\n  return __jsx(\"div\", {\n    className: classesMiddleWrap['main-cart-modal'],\n    ref: ref\n  }, data.length ? __jsx(React.Fragment, null, __jsx(\"ul\", null, _cart), __jsx(\"a\", {\n    href: \"/cart\",\n    className: classesMiddleWrap['view-all-cart-btn'],\n    onClick: hideModal\n  }, \"View All\")) : 'You dont have any added product in your cart yet');\n});\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    isUser: state.auth.user\n  };\n};\n\nvar mapDispatchToProps = {};\nexport default connect(mapStateToProps, mapDispatchToProps)(MiddleWrap);","map":null,"metadata":{},"sourceType":"module"}