{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Reflect$construct from \"@babel/runtime-corejs2/core-js/reflect/construct\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nimport _Object$entries from \"@babel/runtime-corejs2/core-js/object/entries\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _Object$values from \"@babel/runtime-corejs2/core-js/object/values\";\nimport _getIterator from \"@babel/runtime-corejs2/core-js/get-iterator\";\nimport _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) {\n  function isNativeReflectConstruct() {\n    if (typeof Reflect === \"undefined\" || !_Reflect$construct) return false;\n    if (_Reflect$construct.sham) return false;\n    if (typeof Proxy === \"function\") return true;\n\n    try {\n      Date.prototype.toString.call(_Reflect$construct(Date, [], function () {}));\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  return function () {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (isNativeReflectConstruct()) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = _Reflect$construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { Fragment, useState, useEffect, useCallback } from 'react';\nimport classes from './categories.scss';\nimport { Modal, ModalHeader, ModalBody, Tooltip } from 'reactstrap';\nimport Icon from 'components/Icons/icon';\nimport { ONLY_ENGLISH_LETTERS_WITH_DIGIT_PATTERN } from 'utils';\nimport UI_ELEMENTS from 'components/shared/UI';\nimport { useForm } from 'react-hook-form';\nimport PropTypes from 'prop-types';\nimport axios from 'lib/axiosEnv';\nimport { toast } from 'react-toastify';\nimport { __SET_CATEGORY_LIST } from 'store/actions';\nimport { connect } from 'react-redux';\nimport Router from 'next/router';\n\nvar _require = require('utils/auth'),\n    getToken = _require.getToken;\n\nimport { Bus } from 'lib/EventEmitter';\n\nvar CRUDCategoryForm = function CRUDCategoryForm(props) {\n  var _useForm = useForm({\n    mode: 'onBlur'\n  }),\n      register = _useForm.register,\n      handleSubmit = _useForm.handleSubmit,\n      errors = _useForm.errors,\n      reset = _useForm.reset,\n      setValue = _useForm.setValue;\n\n  var _useState = useState(false),\n      loadingCategory = _useState[0],\n      setLoadingCategory = _useState[1];\n\n  var _useState2 = useState(false),\n      tooltipOpen = _useState2[0],\n      setTooltipOpen = _useState2[1];\n\n  var _useState3 = useState(''),\n      typeCRUD = _useState3[0],\n      setTypeCRUD = _useState3[1];\n\n  var _useState4 = useState([]),\n      subCategoryContent = _useState4[0],\n      setSubCategoryContent = _useState4[1];\n\n  var _useState5 = useState(''),\n      categoryContent = _useState5[0],\n      setCategoryContent = _useState5[1];\n\n  var _useState6 = useState(null),\n      deepCategoryContent = _useState6[0],\n      setDeepCategoryContent = _useState6[1];\n\n  var toastOpt = {\n    position: 'top-right',\n    autoClose: 3000,\n    pauseOnHover: false\n  };\n\n  var toggle = function toggle() {\n    return setTooltipOpen(!tooltipOpen);\n  }; // Generate new ParamName\n\n\n  var generateName = function generateName(begin, state) {\n    if (state.some(function (s) {\n      return s.name === 'subCategory' + begin;\n    })) {\n      return generateName(begin + 1, state);\n    } else return 'subCategory' + begin;\n  };\n\n  var addSubCategoryField = function addSubCategoryField() {\n    setSubCategoryContent(function (prevState) {\n      return [].concat(_toConsumableArray(prevState), [{\n        value: '',\n        name: generateName(0, subCategoryContent)\n      }]);\n    });\n  };\n\n  var saveChanges = function saveChanges(data) {\n    var fakeCategories = _toConsumableArray(subCategoryContent);\n\n    var index = fakeCategories.findIndex(function (item) {\n      return item.name === data.name;\n    });\n\n    if (index > -1) {\n      fakeCategories[index].value = data.value;\n    }\n  };\n\n  var removeCategory = useCallback(function (name, state) {\n    if (name === 'name') {\n      setCategoryContent('removed');\n      setSubCategoryContent([]);\n      return;\n    }\n\n    var prevState = _toConsumableArray(state);\n\n    var indexRem = prevState.findIndex(function (obj) {\n      return obj.name === name;\n    });\n\n    if (indexRem > -1) {\n      prevState.splice(indexRem, 1);\n    }\n\n    setSubCategoryContent(prevState);\n  }, [categoryContent, subCategoryContent]);\n  useEffect(function () {\n    if (_Object$keys(props.editCategoryData).length) {\n      // Saving Cloned Data before editing\n      setDeepCategoryContent(JSON.parse(_JSON$stringify(props.editCategoryData)));\n      setValue('name', props.editCategoryData.text);\n      setCategoryContent(props.editCategoryData.text);\n      props.editCategoryData.dataSub.forEach(function (el) {\n        setSubCategoryContent(function (prevState) {\n          return [].concat(_toConsumableArray(prevState), [{\n            value: el.text,\n            name: el.id\n          }]);\n        });\n      });\n    }\n  }, [props.editCategoryData]);\n  useEffect(function () {\n    setTypeCRUD(props.crudType);\n  }, [props.crudType]);\n  useEffect(function () {\n    subCategoryContent.forEach(function (e) {\n      if (props.crudType === 'edit') {\n        setValue(e.name, e.value);\n      }\n    });\n  }, [subCategoryContent]);\n\n  var reflect = function reflect(promise) {\n    return promise.then(function (v) {\n      return {\n        v: v,\n        status: 'fulfilled'\n      };\n    }, function (e) {\n      return {\n        e: e,\n        status: 'rejected'\n      };\n    });\n  };\n\n  var onSubmit =\n  /*#__PURE__*/\n  function () {\n    var _ref = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2(dataCategory) {\n      var editedObj, parentSlug, getSubCategories, _ref2, data, added, removed, updated, addPromise, updatePromise, removePromise, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _loop, _iterator, _step, _iteratorNormalCompletion2, _didIteratorError2, _iteratorError2, _loop2, _iterator2, _step2, _iteratorNormalCompletion3, _didIteratorError3, _iteratorError3, _loop3, _iterator3, _step3, promiseAllArr, results, success, updatedCategory, updatedSubCategory, addedSubCategory, removedSubCategory, _getSubCategories, _ref3, _data, promisesSub, subData, subCategoriesFail;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n\n              if (!(typeCRUD === 'edit')) {\n                _context2.next = 89;\n                break;\n              }\n\n              editedObj = {};\n              parentSlug = deepCategoryContent.link.pathname.split('/').pop();\n              getSubCategories = _Object$keys(dataCategory).reduce(function (acc, sub) {\n                if (sub !== 'name') {\n                  if (!deepCategoryContent.dataSub.find(function (obj) {\n                    return obj.id === sub;\n                  })) {\n                    acc[sub] = dataCategory[sub];\n                  } else {\n                    acc[sub] = {\n                      name: deepCategoryContent.dataSub.find(function (obj) {\n                        return obj.id === sub;\n                      }).text,\n                      newName: dataCategory[sub],\n                      category: deepCategoryContent.text\n                    };\n                  }\n                }\n\n                return acc;\n              }, {});\n\n              if (dataCategory.hasOwnProperty('name')) {\n                _context2.next = 15;\n                break;\n              }\n\n              _context2.next = 8;\n              return axios[\"delete\"]('/api/remove/category', {\n                headers: {\n                  Authorization: getToken('token')\n                },\n                data: {\n                  name: deepCategoryContent.text\n                }\n              });\n\n            case 8:\n              _ref2 = _context2.sent;\n              data = _ref2.data;\n\n              if (!data.error) {\n                _context2.next = 12;\n                break;\n              }\n\n              throw Error(data.error);\n\n            case 12:\n              toast.dark(data.message, toastOpt);\n              props.handlerForm(typeCRUD, {\n                name: deepCategoryContent.text,\n                removed: true\n              });\n              return _context2.abrupt(\"return\");\n\n            case 15:\n              added = [], removed = [], updated = [];\n\n              if (dataCategory.name && dataCategory.name !== deepCategoryContent.text) {\n                updated.push({\n                  name: deepCategoryContent.text,\n                  text: dataCategory.name\n                });\n              } // Added\n\n\n              _Object$keys(getSubCategories).forEach(function (obj) {\n                if (obj.indexOf('subCategory') > -1) {\n                  added.push(_defineProperty({}, obj, getSubCategories[obj]));\n                }\n              }); // Removed\n\n\n              deepCategoryContent.dataSub.forEach(function (rem) {\n                if (!getSubCategories.hasOwnProperty(rem.id)) {\n                  removed.push({\n                    name: rem.text,\n                    category: deepCategoryContent.text\n                  });\n                }\n              }); // Updated\n\n              deepCategoryContent.dataSub.forEach(function (rem) {\n                if (getSubCategories.hasOwnProperty(rem.id) && getSubCategories[rem.id].newName !== rem.text) {\n                  var obj = getSubCategories[rem.id];\n                  updated.push({\n                    subName: obj.name,\n                    text: obj.newName,\n                    category: obj.category\n                  });\n                }\n              });\n              addPromise = [], updatePromise = [], removePromise = [];\n              _iteratorNormalCompletion = true;\n              _didIteratorError = false;\n              _iteratorError = undefined;\n              _context2.prev = 24;\n\n              _loop = function _loop() {\n                var add = _step.value;\n                addPromise.push(new _Promise(function (resolve, reject) {\n                  axios.post('/api/add/subCategory', {\n                    name: _Object$values(add)[0],\n                    category: dataCategory.name\n                  }, {\n                    headers: {\n                      Authorization: getToken('token')\n                    }\n                  }).then(function (res) {\n                    return resolve(res);\n                  })[\"catch\"](function (err) {\n                    return reject(err);\n                  });\n                }));\n              };\n\n              for (_iterator = _getIterator(added); !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                _loop();\n              }\n\n              _context2.next = 33;\n              break;\n\n            case 29:\n              _context2.prev = 29;\n              _context2.t0 = _context2[\"catch\"](24);\n              _didIteratorError = true;\n              _iteratorError = _context2.t0;\n\n            case 33:\n              _context2.prev = 33;\n              _context2.prev = 34;\n\n              if (!_iteratorNormalCompletion && _iterator[\"return\"] != null) {\n                _iterator[\"return\"]();\n              }\n\n            case 36:\n              _context2.prev = 36;\n\n              if (!_didIteratorError) {\n                _context2.next = 39;\n                break;\n              }\n\n              throw _iteratorError;\n\n            case 39:\n              return _context2.finish(36);\n\n            case 40:\n              return _context2.finish(33);\n\n            case 41:\n              _iteratorNormalCompletion2 = true;\n              _didIteratorError2 = false;\n              _iteratorError2 = undefined;\n              _context2.prev = 44;\n\n              _loop2 = function _loop2() {\n                var rem = _step2.value;\n                removePromise.push(new _Promise(function (resolve, reject) {\n                  axios[\"delete\"]('/api/delete/subCategory', {\n                    headers: {\n                      Authorization: getToken('token')\n                    },\n                    data: {\n                      name: rem.name,\n                      category: rem.category\n                    }\n                  }).then(function (res) {\n                    return resolve(res);\n                  })[\"catch\"](function (err) {\n                    return reject(err);\n                  });\n                }));\n              };\n\n              for (_iterator2 = _getIterator(removed); !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n                _loop2();\n              }\n\n              _context2.next = 53;\n              break;\n\n            case 49:\n              _context2.prev = 49;\n              _context2.t1 = _context2[\"catch\"](44);\n              _didIteratorError2 = true;\n              _iteratorError2 = _context2.t1;\n\n            case 53:\n              _context2.prev = 53;\n              _context2.prev = 54;\n\n              if (!_iteratorNormalCompletion2 && _iterator2[\"return\"] != null) {\n                _iterator2[\"return\"]();\n              }\n\n            case 56:\n              _context2.prev = 56;\n\n              if (!_didIteratorError2) {\n                _context2.next = 59;\n                break;\n              }\n\n              throw _iteratorError2;\n\n            case 59:\n              return _context2.finish(56);\n\n            case 60:\n              return _context2.finish(53);\n\n            case 61:\n              _iteratorNormalCompletion3 = true;\n              _didIteratorError3 = false;\n              _iteratorError3 = undefined;\n              _context2.prev = 64;\n\n              _loop3 = function _loop3() {\n                var up = _step3.value;\n\n                if (up.subName) {\n                  // For sub Categories\n                  updatePromise.push(new _Promise(function (resolve, reject) {\n                    axios.put('/api/update/subCategory', {\n                      name: up.subName,\n                      newName: up.text,\n                      category: up.category\n                    }, {\n                      headers: {\n                        Authorization: getToken('token')\n                      }\n                    }).then(function (res) {\n                      return resolve(res);\n                    })[\"catch\"](function (err) {\n                      return reject(err);\n                    });\n                  }));\n                } else {\n                  // For Categories\n                  updatePromise.push(new _Promise(function (resolve, reject) {\n                    axios.put('/api/update/category', {\n                      name: up.name,\n                      text: up.text\n                    }, {\n                      headers: {\n                        Authorization: getToken('token')\n                      }\n                    }).then(function (res) {\n                      return resolve(res);\n                    })[\"catch\"](function (err) {\n                      return reject(err);\n                    });\n                  }));\n                }\n              };\n\n              for (_iterator3 = _getIterator(updated); !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n                _loop3();\n              }\n\n              _context2.next = 73;\n              break;\n\n            case 69:\n              _context2.prev = 69;\n              _context2.t2 = _context2[\"catch\"](64);\n              _didIteratorError3 = true;\n              _iteratorError3 = _context2.t2;\n\n            case 73:\n              _context2.prev = 73;\n              _context2.prev = 74;\n\n              if (!_iteratorNormalCompletion3 && _iterator3[\"return\"] != null) {\n                _iterator3[\"return\"]();\n              }\n\n            case 76:\n              _context2.prev = 76;\n\n              if (!_didIteratorError3) {\n                _context2.next = 79;\n                break;\n              }\n\n              throw _iteratorError3;\n\n            case 79:\n              return _context2.finish(76);\n\n            case 80:\n              return _context2.finish(73);\n\n            case 81:\n              promiseAllArr = [].concat(_toConsumableArray(updatePromise), _toConsumableArray(addPromise), _toConsumableArray(removePromise));\n              _context2.next = 84;\n              return _Promise.all(promiseAllArr.map(reflect));\n\n            case 84:\n              results = _context2.sent;\n              success = results.filter(function (x) {\n                return x.status === 'fulfilled';\n              });\n\n              if (success.length !== promiseAllArr.length) {\n                toast.error('Some request went wrong!', toastOpt);\n              } else {\n                toast.dark('Requests was gone successfully!', toastOpt);\n                updatedCategory = success.filter(function (x) {\n                  return x.v.data.updatedCategory;\n                });\n                updatedSubCategory = success.filter(function (x) {\n                  return x.v.data.updatedSubCategory;\n                });\n                addedSubCategory = success.filter(function (x) {\n                  return x.v.data.subCategory;\n                });\n                removedSubCategory = success.filter(function (x) {\n                  return x.v.data.removedSubCategory;\n                });\n                editedObj.dataSub = deepCategoryContent.dataSub;\n                editedObj.data = {\n                  name: deepCategoryContent.text,\n                  edited: true\n                };\n\n                if (updatedCategory.length) {\n                  editedObj.data.newName = updatedCategory[0].v.data.updatedCategory.name;\n                  parentSlug = editedObj.data.newSlug = updatedCategory[0].v.data.updatedCategory.slug;\n                  editedObj.dataSub.forEach(function (el) {\n                    var linkSub = el.link.pathname.split('/').pop();\n                    el.link.pathname = '/shop/' + parentSlug + '/' + linkSub;\n                  });\n                }\n\n                if (updatedSubCategory.length) {\n                  updatedSubCategory.forEach(function (el) {\n                    var findOldSub = editedObj.dataSub.findIndex(function (i) {\n                      return i.text === el.v.data.updatedSubCategory.oldName;\n                    });\n\n                    if (findOldSub > -1) {\n                      editedObj.dataSub[findOldSub].text = el.v.data.updatedSubCategory.name;\n                      editedObj.dataSub[findOldSub].link.pathname = '/shop/' + parentSlug + '/' + el.v.data.updatedSubCategory.slug;\n                    }\n                  });\n                }\n\n                if (removedSubCategory.length) {\n                  removedSubCategory.forEach(function (el) {\n                    var findRemSub = editedObj.dataSub.findIndex(function (i) {\n                      return i.text === el.v.data.removedSubCategory.name;\n                    });\n\n                    if (findRemSub > -1) {\n                      editedObj.dataSub.splice(findRemSub, 1);\n                    }\n                  });\n                }\n\n                if (addedSubCategory.length) {\n                  addedSubCategory.forEach(function (el) {\n                    var added = el.v.data.subCategory;\n\n                    if (added) {\n                      editedObj.dataSub.push({\n                        id: added._id,\n                        text: added.name,\n                        link: {\n                          pathname: '/shop/' + parentSlug + '/' + added.slug\n                        }\n                      });\n                    }\n                  });\n                }\n\n                props.handlerForm(typeCRUD, editedObj.data, editedObj.dataSub);\n              }\n\n              _context2.next = 108;\n              break;\n\n            case 89:\n              _getSubCategories = _Object$keys(dataCategory).reduce(function (acc, sub) {\n                if (sub !== 'name') acc[sub] = dataCategory[sub];\n                return acc;\n              }, {}); // Remove all Sub category fields before creating\n\n              if (_Object$keys(_getSubCategories).length) {\n                _Object$keys(_getSubCategories).forEach(function (remSub) {\n                  return delete dataCategory[remSub];\n                });\n              }\n\n              _context2.next = 93;\n              return axios.post('/api/add/category', dataCategory, {\n                headers: {\n                  Authorization: getToken('token')\n                }\n              });\n\n            case 93:\n              _ref3 = _context2.sent;\n              _data = _ref3.data;\n\n              if (!_data.error) {\n                _context2.next = 97;\n                break;\n              }\n\n              throw Error(_data.error.message || _data.error);\n\n            case 97:\n              // If there are SubCategories\n              promisesSub = [];\n              subData = [];\n              subCategoriesFail = false;\n              _context2.next = 102;\n              return function () {\n                if (_Object$keys(_getSubCategories).length) {\n                  var _loop4 = function _loop4(i, _p) {\n                    _p = _p.then(function (_) {\n                      return new _Promise(\n                      /*#__PURE__*/\n                      function () {\n                        var _ref4 = _asyncToGenerator(\n                        /*#__PURE__*/\n                        _regeneratorRuntime.mark(function _callee(resolve) {\n                          var dataSub;\n                          return _regeneratorRuntime.wrap(function _callee$(_context) {\n                            while (1) {\n                              switch (_context.prev = _context.next) {\n                                case 0:\n                                  _context.next = 2;\n                                  return axios.post('/api/add/subCategory', {\n                                    name: _getSubCategories[_Object$keys(_getSubCategories)[i]],\n                                    category: _data.category.name\n                                  }, {\n                                    headers: {\n                                      Authorization: getToken('token')\n                                    }\n                                  });\n\n                                case 2:\n                                  dataSub = _context.sent;\n                                  if (dataSub.data.error) subCategoriesFail = true;else {\n                                    subData.push(dataSub.data.subCategory);\n                                  }\n                                  resolve();\n\n                                case 5:\n                                case \"end\":\n                                  return _context.stop();\n                              }\n                            }\n                          }, _callee);\n                        }));\n\n                        return function (_x2) {\n                          return _ref4.apply(this, arguments);\n                        };\n                      }());\n                    });\n                    promisesSub.push(_p);\n                    p = _p;\n                  };\n\n                  for (var i = 0, p = _Promise.resolve(); i < _Object$keys(_getSubCategories).length; i++) {\n                    _loop4(i, p);\n                  }\n                }\n\n                return _Promise.all(promisesSub);\n              }();\n\n            case 102:\n              if (!subCategoriesFail) {\n                _context2.next = 106;\n                break;\n              }\n\n              throw Error('Something went wrong with Sub Categories!');\n\n            case 106:\n              toast.dark(_data.message, toastOpt);\n              props.handlerForm(typeCRUD, _data, subData);\n\n            case 108:\n              _context2.next = 113;\n              break;\n\n            case 110:\n              _context2.prev = 110;\n              _context2.t3 = _context2[\"catch\"](0);\n              toast.error(_context2.t3.response ? _context2.t3.response.data : _context2.t3.message, toastOpt);\n\n            case 113:\n              _context2.prev = 113;\n              props.closeModal();\n              reset();\n              return _context2.finish(113);\n\n            case 117:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 110, 113, 117], [24, 29, 33, 41], [34,, 36, 40], [44, 49, 53, 61], [54,, 56, 60], [64, 69, 73, 81], [74,, 76, 80]]);\n    }));\n\n    return function onSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(React.Fragment, null, __jsx(\"form\", {\n    id: \"category-form\",\n    onSubmit: handleSubmit(onSubmit)\n  }, categoryContent !== 'removed' ? __jsx(\"div\", {\n    className: classes['parentUI-input']\n  }, __jsx(UI_ELEMENTS.Input, {\n    type: \"text\",\n    name: \"name\",\n    refBind: categoryContent ? React.createRef() : register(ONLY_ENGLISH_LETTERS_WITH_DIGIT_PATTERN),\n    errors: errors.name && errors.name.message,\n    fullWidth: true,\n    placeholder: \"Name\",\n    size: \"sm\"\n  }), __jsx(\"span\", {\n    className: classes['remove-icon'],\n    onClick: function onClick() {\n      return removeCategory('name', categoryContent);\n    }\n  }, __jsx(Icon, {\n    name: \"close\"\n  }))) : '', subCategoryContent.length ? __jsx(\"div\", {\n    className: classes.subCategoryContent\n  }, \" \", subCategoryContent.map(function (_, index) {\n    return __jsx(\"div\", {\n      key: _.category + _.name,\n      className: classes['parentUI-input']\n    }, __jsx(UI_ELEMENTS.Input, {\n      type: \"text\",\n      events: ['change'],\n      onChange: function onChange(e) {\n        return saveChanges({\n          value: e.target.value,\n          name: _.name\n        });\n      },\n      name: _.name,\n      refBind: register(ONLY_ENGLISH_LETTERS_WITH_DIGIT_PATTERN),\n      errors: errors[_.name] && errors[_.name].message,\n      fullWidth: true,\n      placeholder: \"Sub category name\",\n      size: \"sm\"\n    }), __jsx(\"span\", {\n      className: classes['remove-icon'],\n      onClick: function onClick() {\n        return removeCategory(_.name, subCategoryContent);\n      }\n    }, __jsx(Icon, {\n      name: \"close\"\n    })));\n  })) : '', __jsx(\"div\", {\n    className: classes.addCategory\n  }, __jsx(UI_ELEMENTS.Button, {\n    icon: loadingCategory ? {\n      dir: 'right',\n      element: 'loading'\n    } : {},\n    type: \"submit\",\n    text: \"Save\",\n    width: 100,\n    margin: ['0px', '0', '0', 'auto'],\n    attr: [{\n      id: 'saveBtn'\n    }],\n    size: \"sm\"\n  }), categoryContent !== 'removed' ? __jsx(\"a\", {\n    id: \"add-category-sub\",\n    onClick: addSubCategoryField\n  }, \"+\") : ''), __jsx(Tooltip, {\n    placement: \"right\",\n    isOpen: tooltipOpen,\n    target: \"add-category-sub\",\n    toggle: toggle\n  }, \"Add Sub Category\")));\n};\n\nCRUDCategoryForm.propTypes = {\n  crudType: PropTypes.string,\n  editCategoryData: PropTypes.object,\n  handlerForm: PropTypes.func,\n  closeModal: PropTypes.func\n};\n\nvar Li = function Li(props) {\n  var data = props.data,\n      parent = props.parent;\n\n  var _useState7 = useState(false),\n      open = _useState7[0],\n      setOpen = _useState7[1];\n\n  var _useState8 = useState(0),\n      height = _useState8[0],\n      setHeight = _useState8[1];\n\n  var openSubMenu = function openSubMenu(evt, index) {\n    setHeight(height = 0);\n    evt.stopPropagation();\n    evt.preventDefault();\n    setOpen(open = parent.current.children[index] && parent.current.children[index].classList.contains('openItemDropdown'));\n    parent.current.children[index].classList[!open ? 'add' : 'remove']('openItemDropdown');\n    !open ? parent.current.children[index].querySelectorAll('.' + classes['submenu_dropdown'] + ' > li').forEach(function (_) {\n      return setHeight(height += _.getBoundingClientRect().height);\n    }) : setHeight(height = 0);\n    parent.current.children[index].querySelector('.' + classes['submenu_dropdown']).style.maxHeight = height + 'px';\n  };\n\n  var goToShop = function goToShop(path) {\n    _Object$keys(Router.query).forEach(function (qu) {\n      // Remove unnecessary query params\n      if (qu !== 'name' && qu !== 'category' && qu !== 'subCategory' && qu !== 'page' && qu !== 'maxPrice' && qu !== 'minPrice') delete Router.query[qu];\n    });\n\n    var query = _objectSpread({}, Router.query);\n\n    if (path.hasOwnProperty('querySubCategory')) {\n      query.category = path.queryCategory;\n      query.subCategory = path.querySubCategory;\n    } else if (path.hasOwnProperty('queryCategory')) {\n      query.category = path.queryCategory;\n      delete query.subCategory;\n    }\n\n    query.page = 1;\n    Router.push({\n      pathname: '/shop',\n      query: _objectSpread({}, query)\n    }).then(function () {\n      return Bus.dispatch('filterByCategory');\n    });\n  };\n\n  var openModal = function openModal(el, index) {\n    setHeight(0);\n    setOpen(true);\n    parent.current.children[index].classList.remove('openItemDropdown');\n\n    if (!open && parent.current.children[index].querySelector('.' + classes['submenu_dropdown'])) {\n      parent.current.children[index].querySelector('.' + classes['submenu_dropdown']).style.maxHeight = '0px';\n    }\n\n    props.openPropModal(el);\n  };\n\n  if (data instanceof Object) {\n    var _li = _Object$keys(data).map(function (_el, index) {\n      var display = data[_el].link.pathname ? __jsx(\"a\", {\n        onClick: function onClick() {\n          return goToShop(data[_el]);\n        }\n      }, data[_el].text, \" \", data[_el].hasOwnProperty('dataSub') && _Object$keys(data[_el].dataSub).length > 0 ? __jsx(\"span\", {\n        className: classes['dropdown_arrow'],\n        onClick: function onClick(e) {\n          return openSubMenu(e, index);\n        }\n      }) : '') : __jsx(\"span\", null, data[_el].text);\n      var subMenu;\n\n      if (data[_el].hasOwnProperty('dataSub') && _Object$keys(data[_el].dataSub).length > 0) {\n        subMenu = __jsx(Li, {\n          data: data[_el].dataSub,\n          isAdmin: props.isAdmin\n        });\n      }\n\n      return __jsx(\"li\", {\n        key: index,\n        className: props.isAdmin ? 'admin-icon-relative' : ''\n      }, display, props.isAdmin && __jsx(\"span\", {\n        className: \"admin-icon\",\n        onClick: function onClick() {\n          return openModal(data[_el], index);\n        }\n      }, __jsx(Icon, {\n        name: \"pencil\"\n      })), subMenu ? __jsx(\"ul\", {\n        className: classes['submenu_dropdown']\n      }, subMenu) : '');\n    });\n\n    return __jsx(Fragment, null, _li);\n  }\n};\n\nLi.propTypes = {\n  openPropModal: PropTypes.func,\n  parent: PropTypes.object,\n  isAdmin: PropTypes.bool\n};\n\nvar Categories =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Categories, _React$Component);\n\n  var _super = _createSuper(Categories);\n\n  function Categories(props) {\n    var _this;\n\n    _classCallCheck(this, Categories);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"componentDidMount\",\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee3() {\n      var _ref6, data;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              _context3.next = 3;\n              return axios.get('/api/get/categories');\n\n            case 3:\n              _ref6 = _context3.sent;\n              data = _ref6.data;\n\n              if (!data.error) {\n                _context3.next = 7;\n                break;\n              }\n\n              throw Error(data.error);\n\n            case 7:\n              _this.setState({\n                categoryList: function () {\n                  var list = {};\n\n                  var _loop5 = function _loop5(i) {\n                    list[data.category[i].name] = {\n                      text: data.category[i].name,\n                      queryCategory: data.category[i].slug,\n                      link: {\n                        pathname: '/shop?category=' + data.category[i].slug + _this.routerQueries(['category'])\n                      },\n                      dataSub: data.subCategory.reduce(function (acc, sub) {\n                        if (sub.category === data.category[i].name) {\n                          acc.push({\n                            queryCategory: data.category[i].slug,\n                            querySubCategory: sub.slug,\n                            text: sub.name,\n                            id: sub._id,\n                            link: {\n                              pathname: '/shop?category=' + data.category[i].slug + '&subCategory=' + sub.slug + _this.routerQueries(['category', 'subCategory'])\n                            }\n                          });\n                        }\n\n                        return acc;\n                      }, [])\n                    };\n                  };\n\n                  for (var i = 0; i < data.category.length; i++) {\n                    _loop5(i);\n                  }\n\n                  return list;\n                }()\n              }, function () {\n                _this.props.__SET_CATEGORY_LIST(_this.state.categoryList);\n              });\n\n              _context3.next = 13;\n              break;\n\n            case 10:\n              _context3.prev = 10;\n              _context3.t0 = _context3[\"catch\"](0);\n              toast.error(_context3.t0.response ? _context3.t0.response.data : _context3.t0.message, {\n                position: 'top-right',\n                autoClose: 3000,\n                pauseOnHover: false\n              });\n\n            case 13:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[0, 10]]);\n    })));\n\n    _this.state = {\n      modal: false,\n      crudType: '',\n      categoryList: {},\n      editCategoryData: {}\n    };\n    _this.openModal = _this.openModal.bind(_assertThisInitialized(_this));\n    _this.routerQueries = _this.routerQueries.bind(_assertThisInitialized(_this));\n    _this.handlerChangesCRUD = _this.handlerChangesCRUD.bind(_assertThisInitialized(_this));\n    _this.categoryRef = React.createRef();\n    return _this;\n  }\n\n  _createClass(Categories, [{\n    key: \"routerQueries\",\n    value: function routerQueries(besides) {\n      var queries = '';\n\n      _Object$keys(Router.query).forEach(function (query) {\n        if (besides.indexOf(query) === -1) {\n          queries += '&' + query + '=' + Router.query[query];\n        }\n      });\n\n      return queries;\n    }\n  }, {\n    key: \"openModal\",\n    value: function openModal() {\n      var type = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'add';\n      var dataEdit = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      this.setState({\n        editCategoryData: dataEdit,\n        crudType: typeof type === 'string' ? type : '',\n        modal: !this.state.modal\n      });\n    }\n  }, {\n    key: \"handlerChangesCRUD\",\n    value: function handlerChangesCRUD(type, data) {\n      var subData = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n\n      if (type === 'edit' && data.edited) {\n        var nameCategory = data.newName || data.name;\n        var prevStateCategory = this.state.categoryList;\n\n        if (data.newName) {\n          var nameCategorySlug = function () {\n            var arr = prevStateCategory[data.name].link.pathname.split('/');\n            arr.pop();\n            arr.push(data.newSlug);\n            return arr.join('/');\n          }();\n\n          prevStateCategory[data.newName] = prevStateCategory[data.name];\n          delete prevStateCategory[data.name];\n          prevStateCategory[data.newName].text = nameCategory;\n          prevStateCategory[data.newName].link.pathname = nameCategorySlug;\n        }\n\n        var updatedCategoryList = JSON.parse(_JSON$stringify(prevStateCategory[nameCategory]));\n        updatedCategoryList.dataSub = subData;\n        prevStateCategory[nameCategory] = updatedCategoryList;\n        var orderedPrevStateCategory = {};\n\n        _Object$keys(prevStateCategory).sort().forEach(function (key) {\n          orderedPrevStateCategory[key] = prevStateCategory[key];\n        });\n\n        this.setState({\n          categoryList: _objectSpread({}, orderedPrevStateCategory)\n        });\n      } else if (type === 'edit' && data.removed) {\n        Object.filter = function (obj, predicate) {\n          return Object.fromEntries(_Object$entries(obj).filter(predicate));\n        };\n\n        var removedCategory = Object.filter(this.state.categoryList, function (_ref7) {\n          var _ref8 = _slicedToArray(_ref7, 2),\n              name = _ref8[0],\n              list = _ref8[1];\n\n          return list.text !== data.name;\n        });\n        this.setState({\n          categoryList: removedCategory\n        });\n      } else {\n        this.setState(function (prevState) {\n          return {\n            categoryList: _objectSpread({}, prevState.categoryList, _defineProperty({}, data.category.name, {\n              text: data.category.name,\n              link: {\n                pathname: '/shop/' + data.category.slug\n              },\n              dataSub: subData.map(function (sub) {\n                return {\n                  id: sub._id,\n                  text: sub.name,\n                  link: {\n                    pathname: '/shop/' + data.category.slug + '/' + sub.slug\n                  }\n                };\n              })\n            }))\n          };\n        });\n      }\n    }\n  }, {\n    key: \"isAdmin\",\n    value: function isAdmin() {\n      return this.props.isAdmin && this.props.isAdmin.roleType === 'admin';\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return __jsx(\"div\", {\n        className: classes['categories-container']\n      }, __jsx(Modal, {\n        isOpen: this.state.modal,\n        toggle: this.openModal\n      }, __jsx(ModalHeader, {\n        toggle: this.openModal\n      }, \"Add Category\"), __jsx(ModalBody, null, __jsx(CRUDCategoryForm, {\n        closeModal: this.openModal,\n        handlerForm: this.handlerChangesCRUD,\n        crudType: this.state.crudType,\n        editCategoryData: this.state.editCategoryData\n      }))), __jsx(\"div\", {\n        className: \"\".concat(classes['categories-container-header'], \" \").concat(this.isAdmin() ? 'admin-icon-relative' : '')\n      }, __jsx(\"h4\", null, \"Categories\"), this.isAdmin() && __jsx(\"span\", {\n        className: \"admin-icon\",\n        onClick: function onClick() {\n          return _this2.openModal('add');\n        }\n      }, __jsx(Icon, {\n        name: \"plus\"\n      }))), __jsx(\"div\", {\n        className: classes['categories-container-body']\n      }, __jsx(\"ul\", {\n        type: \"none\",\n        ref: this.categoryRef\n      }, __jsx(Li, {\n        data: this.state.categoryList,\n        parent: this.categoryRef,\n        isAdmin: this.isAdmin(),\n        openPropModal: function openPropModal(data) {\n          return _this2.openModal('edit', data);\n        }\n      }))));\n    }\n  }]);\n\n  return Categories;\n}(React.Component);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    isAdmin: state.auth.user\n  };\n};\n\nvar mapDispatchToProps = {\n  __SET_CATEGORY_LIST: __SET_CATEGORY_LIST\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(Categories);","map":{"version":3,"sources":["C:/Users/arthu/OneDrive/Desktop/Important/daser/next/OVENO/components/Home/Categories/categories.jsx"],"names":["React","Fragment","useState","useEffect","useCallback","classes","Modal","ModalHeader","ModalBody","Tooltip","Icon","ONLY_ENGLISH_LETTERS_WITH_DIGIT_PATTERN","UI_ELEMENTS","useForm","PropTypes","axios","toast","__SET_CATEGORY_LIST","connect","Router","require","getToken","Bus","CRUDCategoryForm","props","mode","register","handleSubmit","errors","reset","setValue","loadingCategory","setLoadingCategory","tooltipOpen","setTooltipOpen","typeCRUD","setTypeCRUD","subCategoryContent","setSubCategoryContent","categoryContent","setCategoryContent","deepCategoryContent","setDeepCategoryContent","toastOpt","position","autoClose","pauseOnHover","toggle","generateName","begin","state","some","s","name","addSubCategoryField","prevState","value","saveChanges","data","fakeCategories","index","findIndex","item","removeCategory","indexRem","obj","splice","editCategoryData","length","JSON","parse","text","dataSub","forEach","el","id","crudType","e","reflect","promise","then","v","status","onSubmit","dataCategory","editedObj","parentSlug","link","pathname","split","pop","getSubCategories","reduce","acc","sub","find","newName","category","hasOwnProperty","headers","Authorization","error","Error","dark","message","handlerForm","removed","added","updated","push","indexOf","rem","subName","addPromise","updatePromise","removePromise","add","resolve","reject","post","res","err","up","put","promiseAllArr","all","map","results","success","filter","x","updatedCategory","updatedSubCategory","addedSubCategory","subCategory","removedSubCategory","edited","newSlug","slug","linkSub","findOldSub","i","oldName","findRemSub","_id","remSub","promisesSub","subData","subCategoriesFail","p","_","response","closeModal","createRef","target","addCategory","dir","element","propTypes","string","object","func","Li","parent","open","setOpen","height","setHeight","openSubMenu","evt","stopPropagation","preventDefault","current","children","classList","contains","querySelectorAll","getBoundingClientRect","querySelector","style","maxHeight","goToShop","path","query","qu","queryCategory","querySubCategory","page","dispatch","openModal","remove","openPropModal","Object","_li","_el","display","subMenu","isAdmin","bool","Categories","get","setState","categoryList","list","routerQueries","modal","bind","handlerChangesCRUD","categoryRef","besides","queries","type","dataEdit","nameCategory","prevStateCategory","nameCategorySlug","arr","join","updatedCategoryList","orderedPrevStateCategory","sort","key","predicate","fromEntries","removedCategory","roleType","Component","mapStateToProps","auth","user","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React, { Fragment, useState, useEffect, useCallback } from 'react';\r\nimport classes from './categories.scss';\r\nimport {\r\n    Modal,\r\n    ModalHeader,\r\n    ModalBody,\r\n    Tooltip\r\n} from 'reactstrap';\r\nimport Icon from 'components/Icons/icon';\r\nimport {\r\n    ONLY_ENGLISH_LETTERS_WITH_DIGIT_PATTERN\r\n} from 'utils';\r\nimport UI_ELEMENTS from 'components/shared/UI';\r\nimport { useForm } from 'react-hook-form';\r\nimport PropTypes from 'prop-types'\r\nimport axios from 'lib/axiosEnv';\r\nimport { toast } from 'react-toastify';\r\nimport {\r\n    __SET_CATEGORY_LIST,\r\n} from 'store/actions';\r\nimport { connect } from 'react-redux';\r\nimport Router from 'next/router';\r\n\r\nconst {\r\n    getToken\r\n} = require('utils/auth');\r\nimport { Bus } from 'lib/EventEmitter';\r\n\r\nconst CRUDCategoryForm = (props) => {\r\n    const {\r\n        register,\r\n        handleSubmit,\r\n        errors,\r\n        reset,\r\n        setValue\r\n    } = useForm({\r\n        mode: 'onBlur',\r\n    });\r\n\r\n    const [loadingCategory, setLoadingCategory] = useState(false);\r\n    const [tooltipOpen, setTooltipOpen] = useState(false);\r\n    const [typeCRUD, setTypeCRUD] = useState('');\r\n    const [subCategoryContent, setSubCategoryContent] = useState([]);\r\n    const [categoryContent, setCategoryContent] = useState('');\r\n    const [deepCategoryContent, setDeepCategoryContent] = useState(null);\r\n\r\n    const toastOpt = {\r\n        position: 'top-right',\r\n        autoClose: 3000,\r\n        pauseOnHover: false,\r\n    };\r\n\r\n    const toggle = () => setTooltipOpen(!tooltipOpen);\r\n\r\n    // Generate new ParamName\r\n    const generateName = (begin, state) => {\r\n        if (state.some(s => s.name === 'subCategory' + begin)) {\r\n            return generateName(begin + 1, state);\r\n        } else return 'subCategory' + begin\r\n    };\r\n\r\n\r\n    const addSubCategoryField = () => {\r\n        setSubCategoryContent(prevState => [...prevState, { value: '', name: generateName(0, subCategoryContent) }])\r\n    };\r\n\r\n    const saveChanges = (data) => {\r\n        const fakeCategories = [...subCategoryContent];\r\n        const index = fakeCategories.findIndex(item => item.name === data.name);\r\n        if (index > -1) {\r\n            fakeCategories[index].value = data.value;\r\n        }\r\n    };\r\n\r\n    const removeCategory = useCallback((name, state) => {\r\n        if (name === 'name') {\r\n            setCategoryContent('removed');\r\n            setSubCategoryContent([]);\r\n            return\r\n        }\r\n        const prevState = [...state];\r\n        const indexRem = prevState.findIndex(obj => (obj.name === name));\r\n        if (indexRem > -1) {\r\n            prevState.splice(indexRem, 1);\r\n        }\r\n        setSubCategoryContent(prevState);\r\n    }, [categoryContent, subCategoryContent]);\r\n\r\n    useEffect(() => {\r\n        if (Object.keys(props.editCategoryData).length) {\r\n            // Saving Cloned Data before editing\r\n            setDeepCategoryContent(JSON.parse(JSON.stringify(props.editCategoryData)));\r\n\r\n            setValue('name', props.editCategoryData.text);\r\n            setCategoryContent(props.editCategoryData.text);\r\n            props.editCategoryData.dataSub.forEach(el => {\r\n                setSubCategoryContent(prevState => [...prevState, { value: el.text, name: el.id }])\r\n            });\r\n        }\r\n    }, [props.editCategoryData]);\r\n\r\n\r\n    useEffect(() => {\r\n        setTypeCRUD(props.crudType);\r\n    }, [props.crudType]);\r\n\r\n    useEffect(() => {\r\n        subCategoryContent.forEach(e => {\r\n            if (props.crudType === 'edit') {\r\n                setValue(e.name, e.value);\r\n            }\r\n        })\r\n    }, [subCategoryContent]);\r\n\r\n\r\n    const reflect = (promise) => {\r\n        return promise.then(function (v) {\r\n                return { v: v, status: 'fulfilled' }\r\n            },\r\n            function (e) {\r\n                return { e: e, status: 'rejected' }\r\n            });\r\n    };\r\n\r\n    const onSubmit = async dataCategory => {\r\n        try {\r\n            if (typeCRUD === 'edit') {\r\n                let editedObj = {};\r\n                let parentSlug = deepCategoryContent.link.pathname.split('/').pop();\r\n                const getSubCategories = Object.keys(dataCategory).reduce((acc, sub) => {\r\n                    if (sub !== 'name') {\r\n                        if (!deepCategoryContent.dataSub.find(obj => obj.id === sub)) {\r\n                            acc[sub] = dataCategory[sub];\r\n                        } else {\r\n                            acc[sub] = {\r\n                                name: deepCategoryContent.dataSub.find(obj => obj.id === sub).text,\r\n                                newName: dataCategory[sub],\r\n                                category: deepCategoryContent.text\r\n                            };\r\n                        }\r\n                    }\r\n                    return acc\r\n                }, {});\r\n                if (!dataCategory.hasOwnProperty('name')) {\r\n                    const { data } = await axios.delete('/api/remove/category', {\r\n                        headers: { Authorization: getToken('token') },\r\n                        data: {\r\n                            name: deepCategoryContent.text\r\n                        }\r\n                    });\r\n                    if (data.error) throw Error(data.error);\r\n                    toast.dark(data.message, toastOpt);\r\n                    props.handlerForm(typeCRUD, { name: deepCategoryContent.text, removed: true });\r\n                    return\r\n                }\r\n\r\n                const [added, removed, updated] = [[], [], []];\r\n\r\n                if (dataCategory.name && dataCategory.name !== deepCategoryContent.text) {\r\n                    updated.push({ name: deepCategoryContent.text, text: dataCategory.name })\r\n                }\r\n\r\n                // Added\r\n                Object.keys(getSubCategories).forEach(obj => {\r\n                    if (obj.indexOf('subCategory') > -1) {\r\n                        added.push({ [obj]: getSubCategories[obj] })\r\n                    }\r\n                });\r\n                // Removed\r\n                deepCategoryContent.dataSub.forEach(rem => {\r\n                    if (!getSubCategories.hasOwnProperty(rem.id)) {\r\n                        removed.push({ name: rem.text, category: deepCategoryContent.text })\r\n                    }\r\n                });\r\n                // Updated\r\n                deepCategoryContent.dataSub.forEach(rem => {\r\n                    if (getSubCategories.hasOwnProperty(rem.id) && getSubCategories[rem.id].newName !== rem.text) {\r\n                        const obj = getSubCategories[rem.id];\r\n                        updated.push({ subName: obj.name, text: obj.newName, category: obj.category })\r\n                    }\r\n                });\r\n\r\n                const [addPromise, updatePromise, removePromise] = [[], [], []];\r\n                for (const add of added) {\r\n                    addPromise.push(\r\n                        new Promise((resolve, reject) => {\r\n                            axios.post('/api/add/subCategory', {\r\n                                name: Object.values(add)[0],\r\n                                category: dataCategory.name\r\n                            }, {\r\n                                headers: { Authorization: getToken('token') },\r\n                            }).then(res => resolve(res)).catch(err => reject(err))\r\n                        })\r\n                    )\r\n                }\r\n\r\n                for (const rem of removed) {\r\n                    removePromise.push(\r\n                        new Promise((resolve, reject) => {\r\n                            axios.delete('/api/delete/subCategory', {\r\n                                headers: { Authorization: getToken('token') },\r\n                                data: {\r\n                                    name: rem.name,\r\n                                    category: rem.category\r\n                                }\r\n                            }).then(res => resolve(res)).catch(err => reject(err))\r\n                        })\r\n                    )\r\n                }\r\n\r\n                for (const up of updated) {\r\n                    if (up.subName) { // For sub Categories\r\n                        updatePromise.push(\r\n                            new Promise((resolve, reject) => {\r\n                                axios.put('/api/update/subCategory', {\r\n                                    name: up.subName,\r\n                                    newName: up.text,\r\n                                    category: up.category,\r\n                                }, {\r\n                                    headers: { Authorization: getToken('token') }\r\n                                }).then(res => resolve(res)).catch(err => reject(err))\r\n                            })\r\n                        )\r\n                    } else { // For Categories\r\n                        updatePromise.push(\r\n                            new Promise((resolve, reject) => {\r\n                                axios.put('/api/update/category', {\r\n                                    name: up.name,\r\n                                    text: up.text\r\n                                }, {\r\n                                    headers: { Authorization: getToken('token') }\r\n                                }).then(res => resolve(res)).catch(err => reject(err))\r\n                            })\r\n                        )\r\n                    }\r\n                }\r\n\r\n                const promiseAllArr = [...updatePromise, ...addPromise, ...removePromise];\r\n                const results = await Promise.all(promiseAllArr.map(reflect));\r\n                const success = results.filter(x => x.status === 'fulfilled');\r\n                if (success.length !== promiseAllArr.length) {\r\n                    toast.error('Some request went wrong!', toastOpt);\r\n                } else {\r\n                    toast.dark('Requests was gone successfully!', toastOpt);\r\n                    const updatedCategory = success.filter(x => x.v.data.updatedCategory);\r\n                    const updatedSubCategory = success.filter(x => x.v.data.updatedSubCategory);\r\n                    const addedSubCategory = success.filter(x => x.v.data.subCategory);\r\n                    const removedSubCategory = success.filter(x => x.v.data.removedSubCategory);\r\n                    editedObj.dataSub = deepCategoryContent.dataSub;\r\n                    editedObj.data = {\r\n                        name: deepCategoryContent.text,\r\n                        edited: true,\r\n                    };\r\n\r\n                    if (updatedCategory.length) {\r\n                        editedObj.data.newName = updatedCategory[0].v.data.updatedCategory.name;\r\n                        parentSlug = editedObj.data.newSlug = updatedCategory[0].v.data.updatedCategory.slug;\r\n                        editedObj.dataSub.forEach(el => {\r\n                            const linkSub = el.link.pathname.split('/').pop();\r\n                            el.link.pathname = '/shop/' + parentSlug + '/' + linkSub\r\n                        });\r\n                    }\r\n                    if (updatedSubCategory.length) {\r\n                        updatedSubCategory.forEach(el => {\r\n                            const findOldSub = editedObj.dataSub.findIndex(i => i.text === el.v.data.updatedSubCategory.oldName);\r\n                            if (findOldSub > -1) {\r\n                                editedObj.dataSub[findOldSub].text = el.v.data.updatedSubCategory.name;\r\n                                editedObj.dataSub[findOldSub].link.pathname = '/shop/' + parentSlug + '/' + el.v.data.updatedSubCategory.slug;\r\n                            }\r\n                        })\r\n                    }\r\n                    if (removedSubCategory.length) {\r\n                        removedSubCategory.forEach(el => {\r\n                            const findRemSub = editedObj.dataSub.findIndex(i => i.text === el.v.data.removedSubCategory.name);\r\n                            if (findRemSub > -1) {\r\n                                editedObj.dataSub.splice(findRemSub, 1);\r\n                            }\r\n                        })\r\n                    }\r\n                    if (addedSubCategory.length) {\r\n                        addedSubCategory.forEach(el => {\r\n                            const added = el.v.data.subCategory;\r\n                            if (added) {\r\n                                editedObj.dataSub.push({\r\n                                    id: added._id,\r\n                                    text: added.name,\r\n                                    link: { pathname: '/shop/' + parentSlug + '/' + added.slug }\r\n                                });\r\n                            }\r\n                        })\r\n                    }\r\n                    props.handlerForm(typeCRUD, editedObj.data, editedObj.dataSub);\r\n                }\r\n\r\n            } else {\r\n                const getSubCategories = Object.keys(dataCategory).reduce((acc, sub) => {\r\n                    if (sub !== 'name') acc[sub] = dataCategory[sub];\r\n                    return acc\r\n                }, {});\r\n\r\n                // Remove all Sub category fields before creating\r\n                if (Object.keys(getSubCategories).length) {\r\n                    Object.keys(getSubCategories).forEach(remSub => delete dataCategory[remSub])\r\n                }\r\n\r\n                const { data } = await axios.post('/api/add/category', dataCategory, {\r\n                    headers: { Authorization: getToken('token') }\r\n                });\r\n                if (data.error) {\r\n                    throw Error(data.error.message || data.error)\r\n                }\r\n\r\n                // If there are SubCategories\r\n                const promisesSub = [];\r\n                const subData = [];\r\n                let subCategoriesFail = false;\r\n                await (() => {\r\n                    if (Object.keys(getSubCategories).length) {\r\n                        for (let i = 0, p = Promise.resolve(); i < Object.keys(getSubCategories).length; i++) {\r\n                            p = p.then(_ => new Promise(async resolve => {\r\n                                    const dataSub = await axios.post('/api/add/subCategory', {\r\n                                        name: getSubCategories[Object.keys(getSubCategories)[i]],\r\n                                        category: data.category.name\r\n                                    }, {\r\n                                        headers: { Authorization: getToken('token') }\r\n                                    });\r\n                                    if (dataSub.data.error) subCategoriesFail = true;\r\n                                    else {\r\n                                        subData.push(dataSub.data.subCategory);\r\n                                    }\r\n                                    resolve();\r\n                                }\r\n                            ));\r\n                            promisesSub.push(p);\r\n                        }\r\n                    }\r\n                    return Promise.all(promisesSub);\r\n                })();\r\n\r\n                if (subCategoriesFail) {\r\n                    throw Error('Something went wrong with Sub Categories!');\r\n                } else {\r\n                    toast.dark(data.message, toastOpt);\r\n                    props.handlerForm(typeCRUD, data, subData);\r\n                }\r\n            }\r\n        } catch (err) {\r\n            toast.error(err.response ? err.response.data : err.message, toastOpt);\r\n        } finally {\r\n            props.closeModal();\r\n            reset()\r\n        }\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <form id=\"category-form\" onSubmit={handleSubmit(onSubmit)}>\r\n                {categoryContent !== 'removed' ? <div className={classes['parentUI-input']}>\r\n                    <UI_ELEMENTS.Input\r\n                        type=\"text\"\r\n                        name=\"name\"\r\n                        refBind={categoryContent ? React.createRef() : register(ONLY_ENGLISH_LETTERS_WITH_DIGIT_PATTERN)}\r\n                        errors={errors.name && errors.name.message}\r\n                        fullWidth={true}\r\n                        placeholder=\"Name\"\r\n                        size=\"sm\"/>\r\n                    <span className={classes['remove-icon']} onClick={() => removeCategory('name', categoryContent)}>\r\n                        <Icon name=\"close\"/>\r\n                    </span>\r\n                </div> : ''}\r\n                {subCategoryContent.length ?\r\n                    <div className={classes.subCategoryContent}> {subCategoryContent.map((_, index) => (\r\n                        <div key={_.category + _.name} className={classes['parentUI-input']}>\r\n                            <UI_ELEMENTS.Input\r\n                                type=\"text\"\r\n                                events={['change']}\r\n                                onChange={(e) => saveChanges({ value: e.target.value, name: _.name })}\r\n                                name={_.name}\r\n                                refBind={register(ONLY_ENGLISH_LETTERS_WITH_DIGIT_PATTERN)}\r\n                                errors={errors[_.name] && errors[_.name].message}\r\n                                fullWidth={true}\r\n                                placeholder=\"Sub category name\"\r\n                                size=\"sm\"/>\r\n                            <span className={classes['remove-icon']}\r\n                                  onClick={() => removeCategory(_.name, subCategoryContent)}>\r\n                                <Icon name=\"close\"/>\r\n                            </span>\r\n                        </div>\r\n                    ))}</div> : ''}\r\n                <div className={classes.addCategory}>\r\n                    <UI_ELEMENTS.Button\r\n                        icon={loadingCategory ? { dir: 'right', element: 'loading' } : {}}\r\n                        type=\"submit\"\r\n                        text=\"Save\"\r\n                        width={100}\r\n                        margin={['0px', '0', '0', 'auto']}\r\n                        attr={[\r\n                            { id: 'saveBtn' }\r\n                        ]}\r\n                        size=\"sm\"/>\r\n                    {categoryContent !== 'removed' ?\r\n                        <a id=\"add-category-sub\" onClick={addSubCategoryField}>+</a> : ''}\r\n                </div>\r\n                <Tooltip placement=\"right\" isOpen={tooltipOpen} target=\"add-category-sub\" toggle={toggle}>\r\n                    Add Sub Category\r\n                </Tooltip>\r\n            </form>\r\n        </>\r\n    )\r\n};\r\n\r\nCRUDCategoryForm.propTypes = {\r\n    crudType: PropTypes.string,\r\n    editCategoryData: PropTypes.object,\r\n    handlerForm: PropTypes.func,\r\n    closeModal: PropTypes.func,\r\n};\r\n\r\nconst Li = function (props) {\r\n    const { data, parent } = props;\r\n    let [open, setOpen] = useState(false);\r\n    let [height, setHeight] = useState(0);\r\n    const openSubMenu = (evt, index) => {\r\n        setHeight(height = 0);\r\n        evt.stopPropagation();\r\n        evt.preventDefault();\r\n        setOpen(open = parent.current.children[index] && parent.current.children[index].classList.contains('openItemDropdown'));\r\n        parent.current.children[index].classList[!open ? 'add' : 'remove']('openItemDropdown');\r\n        !open ?\r\n            parent.current.children[index].querySelectorAll('.' + classes['submenu_dropdown'] + ' > li').forEach(_ => setHeight(height += _.getBoundingClientRect().height))\r\n            : setHeight(height = 0);\r\n        parent.current.children[index].querySelector('.' + classes['submenu_dropdown']).style.maxHeight = height + 'px'\r\n    };\r\n    const goToShop = (path) => {\r\n        Object.keys(Router.query).forEach(qu => { // Remove unnecessary query params\r\n            if (qu !== 'name' && qu !== 'category' && qu !== 'subCategory' && qu !== 'page' && qu !== 'maxPrice' && qu !== 'minPrice') delete Router.query[qu]\r\n        });\r\n\r\n        const query = { ...Router.query };\r\n        if (path.hasOwnProperty('querySubCategory')) {\r\n            query.category = path.queryCategory;\r\n            query.subCategory = path.querySubCategory\r\n        } else if (path.hasOwnProperty('queryCategory')) {\r\n            query.category = path.queryCategory;\r\n            delete query.subCategory;\r\n        }\r\n        query.page = 1;\r\n        Router.push({\r\n            pathname: '/shop',\r\n            query: { ...query }\r\n        }).then(() => Bus.dispatch('filterByCategory'))\r\n    };\r\n    const openModal = (el, index) => {\r\n        setHeight(0);\r\n        setOpen(true);\r\n        parent.current.children[index].classList.remove('openItemDropdown');\r\n        if (!open && parent.current.children[index].querySelector('.' + classes['submenu_dropdown'])) {\r\n            parent.current.children[index].querySelector('.' + classes['submenu_dropdown']).style.maxHeight = '0px';\r\n        }\r\n        props.openPropModal(el)\r\n    };\r\n\r\n    if (data instanceof Object) {\r\n        const _li = Object.keys(data).map((_el, index) => {\r\n            const display = (data[_el].link.pathname\r\n                    ?\r\n                    <a onClick={() => goToShop(data[_el])}>{data[_el].text} {(data[_el].hasOwnProperty('dataSub') && Object.keys(data[_el].dataSub).length > 0) ?\r\n                        <span className={classes['dropdown_arrow']}\r\n                              onClick={e => openSubMenu(e, index)}></span> : ''}</a>\r\n                    : <span>{data[_el].text}</span>\r\n            );\r\n            let subMenu;\r\n            if (data[_el].hasOwnProperty('dataSub') && Object.keys(data[_el].dataSub).length > 0) {\r\n                subMenu = <Li data={data[_el].dataSub} isAdmin={props.isAdmin}/>\r\n            }\r\n            return (\r\n                <li key={index} className={props.isAdmin ? 'admin-icon-relative' : ''}>\r\n                    {display}\r\n                    {props.isAdmin &&\r\n                    <span className=\"admin-icon\" onClick={() => openModal(data[_el], index)}>\r\n                        <Icon name=\"pencil\"/>\r\n                    </span>}\r\n                    {subMenu ? <ul className={classes['submenu_dropdown']}>{subMenu}</ul> : ''}\r\n                </li>\r\n            )\r\n        });\r\n        return (<Fragment>{_li}</Fragment>)\r\n    }\r\n};\r\n\r\nLi.propTypes = {\r\n    openPropModal: PropTypes.func,\r\n    parent: PropTypes.object,\r\n    isAdmin: PropTypes.bool,\r\n};\r\n\r\nclass Categories extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            modal: false,\r\n            crudType: '',\r\n            categoryList: {},\r\n            editCategoryData: {},\r\n        };\r\n        this.openModal = this.openModal.bind(this);\r\n        this.routerQueries = this.routerQueries.bind(this);\r\n        this.handlerChangesCRUD = this.handlerChangesCRUD.bind(this);\r\n        this.categoryRef = React.createRef();\r\n    }\r\n\r\n    componentDidMount = async () => {\r\n        try {\r\n            const { data } = await axios.get('/api/get/categories');\r\n            if (data.error) throw Error(data.error);\r\n\r\n            this.setState({\r\n                categoryList: (() => {\r\n                    const list = {};\r\n                    for (let i = 0; i < data.category.length; i++) {\r\n                        list[data.category[i].name] = {\r\n                            text: data.category[i].name,\r\n                            queryCategory: data.category[i].slug,\r\n                            link: { pathname: '/shop?category=' + data.category[i].slug + this.routerQueries(['category']) },\r\n                            dataSub: data.subCategory.reduce((acc, sub) => {\r\n                                if (sub.category === data.category[i].name) {\r\n                                    acc.push({\r\n                                        queryCategory: data.category[i].slug,\r\n                                        querySubCategory: sub.slug,\r\n                                        text: sub.name,\r\n                                        id: sub._id,\r\n                                        link: { pathname: '/shop?category=' + data.category[i].slug + '&subCategory=' + sub.slug + this.routerQueries(['category', 'subCategory']) }\r\n                                    })\r\n                                }\r\n                                return acc\r\n                            }, [])\r\n                        }\r\n                    }\r\n                    return list\r\n                })()\r\n            }, () => {\r\n                this.props.__SET_CATEGORY_LIST(this.state.categoryList)\r\n            })\r\n        } catch (err) {\r\n            toast.error(err.response ? err.response.data : err.message, {\r\n                position: 'top-right',\r\n                autoClose: 3000,\r\n                pauseOnHover: false,\r\n            });\r\n        }\r\n    };\r\n\r\n    routerQueries(besides) {\r\n        let queries = '';\r\n        Object.keys(Router.query).forEach(query => {\r\n            if (besides.indexOf(query) === -1) {\r\n                queries += ('&' + query + '=' + Router.query[query]);\r\n            }\r\n        });\r\n        return queries\r\n    }\r\n\r\n    openModal(type = 'add', dataEdit = {}) {\r\n        this.setState({\r\n            editCategoryData: dataEdit,\r\n            crudType: (typeof type === 'string') ? type : '',\r\n            modal: !this.state.modal\r\n        })\r\n    }\r\n\r\n    handlerChangesCRUD(type, data, subData = []) {\r\n        if (type === 'edit' && data.edited) {\r\n            const nameCategory = data.newName || data.name;\r\n            let prevStateCategory = this.state.categoryList;\r\n            if (data.newName) {\r\n                const nameCategorySlug = (() => {\r\n                    const arr = prevStateCategory[data.name].link.pathname.split('/');\r\n                    arr.pop();\r\n                    arr.push(data.newSlug);\r\n                    return arr.join('/');\r\n                })();\r\n                prevStateCategory[data.newName] = prevStateCategory[data.name];\r\n                delete prevStateCategory[data.name];\r\n                prevStateCategory[data.newName].text = nameCategory;\r\n                prevStateCategory[data.newName].link.pathname = nameCategorySlug\r\n            }\r\n            const updatedCategoryList = JSON.parse(JSON.stringify(prevStateCategory[nameCategory]));\r\n            updatedCategoryList.dataSub = subData;\r\n            prevStateCategory[nameCategory] = updatedCategoryList;\r\n\r\n            const orderedPrevStateCategory = {};\r\n            Object.keys(prevStateCategory).sort().forEach(function (key) {\r\n                orderedPrevStateCategory[key] = prevStateCategory[key];\r\n            });\r\n            this.setState({\r\n                categoryList: {\r\n                    ...orderedPrevStateCategory,\r\n                }\r\n            })\r\n        } else if (type === 'edit' && data.removed) {\r\n            Object.filter = (obj, predicate) =>\r\n                Object.fromEntries(Object.entries(obj).filter(predicate));\r\n\r\n            const removedCategory = Object.filter(this.state.categoryList, ([name, list]) => list.text !== data.name);\r\n            this.setState({\r\n                categoryList: removedCategory\r\n            })\r\n        } else {\r\n            this.setState(prevState => ({\r\n                categoryList: {\r\n                    ...prevState.categoryList,\r\n                    [data.category.name]: {\r\n                        text: data.category.name,\r\n                        link: { pathname: '/shop/' + data.category.slug },\r\n                        dataSub: subData.map(sub => {\r\n                            return {\r\n                                id: sub._id,\r\n                                text: sub.name,\r\n                                link: { pathname: '/shop/' + data.category.slug + '/' + sub.slug }\r\n                            }\r\n                        })\r\n                    }\r\n                }\r\n            }))\r\n        }\r\n    }\r\n\r\n    isAdmin() {\r\n        return this.props.isAdmin && this.props.isAdmin.roleType === 'admin'\r\n    }\r\n\r\n    render() {\r\n        return <div className={classes['categories-container']}>\r\n            <Modal isOpen={this.state.modal} toggle={this.openModal}>\r\n                <ModalHeader toggle={this.openModal}>Add Category</ModalHeader>\r\n                <ModalBody>\r\n                    <CRUDCategoryForm\r\n                        closeModal={this.openModal}\r\n                        handlerForm={this.handlerChangesCRUD}\r\n                        crudType={this.state.crudType}\r\n                        editCategoryData={this.state.editCategoryData}/>\r\n                </ModalBody>\r\n            </Modal>\r\n            <div className={`${classes['categories-container-header']} ${this.isAdmin() ? 'admin-icon-relative' : ''}`}>\r\n                <h4>\r\n                    Categories\r\n                </h4>\r\n                {this.isAdmin() && <span className=\"admin-icon\" onClick={() => this.openModal('add')}>\r\n                    <Icon name=\"plus\"/>\r\n                </span>}\r\n            </div>\r\n            <div className={classes['categories-container-body']}>\r\n                <ul type=\"none\" ref={this.categoryRef}>\r\n                    <Li\r\n                        data={this.state.categoryList}\r\n                        parent={this.categoryRef}\r\n                        isAdmin={this.isAdmin()}\r\n                        openPropModal={(data) => this.openModal('edit', data)}/>\r\n                </ul>\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n\r\nconst mapStateToProps = state => ({\r\n    isAdmin: state.auth.user\r\n});\r\nconst mapDispatchToProps = {\r\n    __SET_CATEGORY_LIST,\r\n};\r\nexport default connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(Categories);\r\n"]},"metadata":{},"sourceType":"module"}